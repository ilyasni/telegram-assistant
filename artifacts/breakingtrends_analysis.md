# üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–ø—É—Å–∫–∞ –ø–æ—Å—Ç–∞ –≤ @breakingtrends

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å—Ç –≤ –∫–∞–Ω–∞–ª–µ @breakingtrends –±—ã–ª –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –≤ **21:45 MSK (18:45 UTC)**, –Ω–æ –Ω–µ –ø–æ–ø–∞–ª –≤ –ë–î.

## –§–∞–∫—Ç—ã

### 1. –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞
- **–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ—Å—Ç –≤ –ë–î**: 2025-11-01 12:31:05 MSK (09:31:05 UTC)
- **–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–π –ø–æ—Å—Ç**: 2025-11-01 21:45 MSK (18:45 UTC)
- **–ü–∞—Ä—Å–∏–Ω–≥ 21:50:06 MSK (18:50:06 UTC)**: 
  - `since_date = 18:12:57 UTC` (–∏–∑ `last_parsed_at`)
  - –ü–æ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã–ª –±—ã—Ç—å –∑–∞—Ö–≤–∞—á–µ–Ω (18:45 > 18:12:57)
- **–ü–∞—Ä—Å–∏–Ω–≥ 22:29:43 MSK (19:29:43 UTC)**:
  - `since_date = 18:50:39 UTC` (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `last_parsed_at`)
  - –ü–æ—Å—Ç —É–∂–µ –±—ã–ª –ø—Ä–æ–ø—É—â–µ–Ω (18:45 < 18:50:39)

### 2. –õ–æ–≥–∏–∫–∞ since_date
–ü–∞—Ä—Å–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `last_parsed_at` –∫–∞–∫ `since_date` –¥–ª—è incremental —Ä–µ–∂–∏–º–∞:
```python
base = channel.get('last_parsed_at') or redis_hwm
since_date = base_utc  # –±–µ–∑ overlap
```

**–ü–†–û–ë–õ–ï–ú–ê**: –ù–µ—Ç overlap, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –ø—Ä–æ–ø—É—Å–∫–∞–º –∏–∑-–∑–∞:
- Race conditions (–ø–æ—Å—Ç –ø–æ—è–≤–∏–ª—Å—è –º–µ–∂–¥—É –ø–∞—Ä—Å–∏–Ω–≥–∞–º–∏)
- –í—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π –º–µ–∂–¥—É Telegram API –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º
- –ó–∞–¥–µ—Ä–∂–µ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram

### 3. –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ
1. –ü–∞—Ä—Å–µ—Ä –≤ 21:50:06 –¥–æ–ª–∂–µ–Ω –±—ã–ª –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –ø–æ—Å—Ç (18:45 > 18:12:57)
2. –ù–æ –ø–æ—Å—Ç –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –≤ –ë–î
3. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
   - Telegram API –µ—â–µ –Ω–µ –≤–µ—Ä–Ω—É–ª —ç—Ç–æ—Ç –ø–æ—Å—Ç (–∑–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏)
   - –ü–æ—Å—Ç –±—ã–ª –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω
   - –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (Context7 best practices)

### 1. –î–æ–±–∞–≤–∏—Ç—å overlap –¥–ª—è since_date
```python
# –î–æ–±–∞–≤–∏—Ç—å -5 –º–∏–Ω—É—Ç overlap –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–æ–≤
since_date = base_utc - timedelta(minutes=5)
```

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ—Å—Ç–∞
–í–º–µ—Å—Ç–æ `last_parsed_at` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `MAX(posted_at)` –∏–∑ –ë–î:
```python
# –ü–æ–ª—É—á–∞—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ—Å—Ç–∞
last_post_date = await get_last_post_date(channel_id)
since_date = last_post_date or last_parsed_at - timedelta(minutes=5)
```

### 3. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–ø—É—Å–∫–æ–≤
- –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å `last_parsed_at` —Å `MAX(posted_at)`
- –ê–ª–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ > 1 —á–∞—Å–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ Telegram API –Ω–µ –≤–µ—Ä–Ω—É–ª –æ–∂–∏–¥–∞–µ–º—ã–µ –ø–æ—Å—Ç—ã

### 4. –î–æ–±–∞–≤–∏—Ç—å backfill –¥–ª—è –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤
–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏ –∑–∞–ø–æ–ª–Ω—è—Ç—å –ø—Ä–æ–ø—É—Å–∫–∏ —á–µ—Ä–µ–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥:
```python
if last_parsed_at - last_post_date > timedelta(hours=1):
    # –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–∞
    await parse_historical(channel_id, since=last_post_date)
```

## –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Telegram API - –±—ã–ª –ª–∏ –ø–æ—Å—Ç –≤–æ–æ–±—â–µ –ø–æ–ª—É—á–µ–Ω
2. üîÑ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä—É—á–Ω–æ–π –ø–∞—Ä—Å–∏–Ω–≥ –¥–ª—è –ø–µ—Ä–∏–æ–¥–∞ 21:30-22:00 MSK
3. üîß –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å overlap –≤ since_date
4. üìä –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫—É `posts_missing_duration_seconds` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤

