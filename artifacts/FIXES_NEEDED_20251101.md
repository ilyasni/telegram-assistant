# üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º E2E —Ç–µ—Å—Ç–æ–≤

**–î–∞—Ç–∞**: 2025-11-01  
**–°—Ç–∞—Ç—É—Å**: –¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –≤ —Å–∫—Ä–∏–ø—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: –°–∫—Ä–∏–ø—Ç `check_pipeline_e2e.py` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –¥–µ—Ñ–æ–ª—Ç 384 –≤–º–µ—Å—Ç–æ 2560

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω `scripts/check_pipeline_e2e.py` (—Å—Ç—Ä–æ–∫–∞ 81)
- –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `EMBEDDING_DIMENSION` (–æ—Å–Ω–æ–≤–Ω–æ–π) –∏–ª–∏ `EMBEDDING_DIM` (fallback)
- –î–µ—Ñ–æ–ª—Ç –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ 2560 (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç GigaChat EmbeddingsGigaR)

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å**:
```python
# –ë—ã–ª–æ:
EMBEDDING_DIM = int(os.getenv("EMBEDDING_DIM", "384"))

# –°—Ç–∞–ª–æ:
EMBEDDING_DIM = int(os.getenv("EMBEDDING_DIMENSION", os.getenv("EMBEDDING_DIM", "2560")))
```

---

## ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞/–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±–æ–≥–∞—â–µ–Ω–∏—è –ø–æ—Å—Ç–æ–≤ (0 –æ–±–æ–≥–∞—â—ë–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Å—Ç—ã –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ Crawl4AI –æ–±–æ–≥–∞—â–µ–Ω–∏–µ

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã**:
1. **–¢—Ä–∏–≥–≥–µ—Ä–Ω—ã–µ —Ç–µ–≥–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç**: –û–±–æ–≥–∞—â–µ–Ω–∏–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ—Å—Ç–æ–≤ —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º–∏ —Ç–µ–≥–∞–º–∏
   - –¢—Ä–∏–≥–≥–µ—Ä—ã: `longread`, `research`, `paper`, `release`, `law`, `deepdive`, `analysis`, `report`, `study`, `whitepaper`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —É –ø–æ—Å—Ç–æ–≤ —ç—Ç–∏ —Ç–µ–≥–∏

2. **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤**: –û–±–æ–≥–∞—â–µ–Ω–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –ø–æ—Å—Ç–æ–≤
   - –ú–∏–Ω–∏–º—É–º: 500 —Å–ª–æ–≤ (`min_word_count: 500`)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–ª–∏–Ω—É –ø–æ—Å—Ç–æ–≤

3. **–õ–∏–º–∏—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –ú–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–µ–≤—ã—à–µ–Ω—ã –ª–∏–º–∏—Ç—ã –Ω–∞ –æ–±–æ–≥–∞—â–µ–Ω–∏–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å—Ç—ã —Å —Ç—Ä–∏–≥–≥–µ—Ä–Ω—ã–º–∏ —Ç–µ–≥–∞–º–∏
docker compose exec -T supabase-db psql -U postgres -d postgres -c "
  SELECT p.id, pe.tags, LENGTH(p.text) as text_length
  FROM posts p
  JOIN post_enrichment pe ON p.id = pe.post_id
  WHERE pe.tags::text LIKE '%longread%'
     OR pe.tags::text LIKE '%research%'
     OR pe.tags::text LIKE '%paper%'
  LIMIT 10;
"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –æ–±–æ–≥–∞—â–µ–Ω–∏—è
docker compose exec worker cat /app/config/enrichment_policy.yml | grep -A 20 crawl4ai
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:
- –ï—Å–ª–∏ –ø–æ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –æ–±–æ–≥–∞—â–∞—Ç—å—Å—è, –Ω–æ –Ω–µ –∏–º–µ—é—Ç —Ç—Ä–∏–≥–≥–µ—Ä–Ω—ã—Ö —Ç–µ–≥–æ–≤ ‚Üí –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥–∏ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- –ï—Å–ª–∏ –ø–æ—Å—Ç—ã —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ ‚Üí —É–º–µ–Ω—å—à–∏—Ç—å `min_word_count` –≤ `enrichment_policy.yml`
- –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –ª–∏–º–∏—Ç–∞—Ö ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `ENRICHMENT_SKIP_LIMITS` –≤ `.env`

---

### 3. –ü—Ä–æ–≤–∞–ª –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –ø–æ—Å—Ç–æ–≤ –≤ Qdrant/Neo4j

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Å—Ç—ã —Å —Ç–µ–≥–∞–º–∏ –Ω–µ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è (–Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ Qdrant –∏ Neo4j)

**–°—Ç–∞—Ç—É—Å**:
- IndexingTask –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- Consumer group `indexing_workers` –∞–∫—Ç–∏–≤–µ–Ω ‚úÖ
- –í stream `posts.enriched` –µ—Å—Ç—å 4238 —Å–æ–æ–±—â–µ–Ω–∏–π ‚úÖ
- –ù–æ –ø–æ—Å—Ç—ã –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞—Ö ‚ùå

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
docker compose logs worker --since 2h | grep -i -E "Failed to process post|error.*indexing|embedding.*failed|graph.*failed"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å pending –ø–æ—Å—Ç—ã
docker compose exec -T supabase-db psql -U postgres -d postgres -c "
  SELECT COUNT(*) as pending_count
  FROM post_enrichment
  WHERE embedding_status = 'pending' OR graph_status = 'pending';
"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å failed –ø–æ—Å—Ç—ã
docker compose exec -T supabase-db psql -U postgres -d postgres -c "
  SELECT post_id, embedding_status, graph_status, error_message
  FROM post_enrichment
  WHERE embedding_status = 'failed' OR graph_status = 'failed'
  LIMIT 5;
"
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã**:
1. **–û—à–∏–±–∫–∏ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤**: –ü—Ä–æ–±–ª–µ–º—ã —Å GigaChat API
2. **–û—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –≤ Qdrant**: –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –¥–∞–Ω–Ω—ã—Ö
3. **–û—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –≤ Neo4j**: –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∏–ª–∏ –≥—Ä–∞—Ñ–æ–º

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ worker –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Qdrant –∏ Neo4j
- –ï—Å–ª–∏ –µ—Å—Ç—å failed –ø–æ—Å—Ç—ã ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å error_message –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø—Ä–∏—á–∏–Ω—ã

---

### 4. Scheduler –≤ —Ä–µ–∂–∏–º–µ idle

**–ü—Ä–æ–±–ª–µ–º–∞**: Scheduler –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω (lock –Ω–µ –Ω–∞–π–¥–µ–Ω, HWM count: 0)

**–°—Ç–∞—Ç—É—Å**: –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –µ—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –¥—Ä—É–≥–æ–π –º–µ—Ö–∞–Ω–∏–∑–º

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å scheduler
docker compose logs telethon-ingest | grep -i scheduler | tail -10

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –ø–∞—Ä—Å–∏–Ω–≥
docker compose logs telethon-ingest | grep -i "parsed.*messages" | tail -5
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:
- –ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `run_ingest_loop` ‚Üí —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- –ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ scheduler ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –ª–æ–≥–∏

---

## üìã –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

1. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏** (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏** (15 –º–∏–Ω—É—Ç)
   ```bash
   docker compose logs worker --since 2h | grep -i "Failed to process post" -A 5
   ```
   - –ù–∞–π—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É –ø—Ä–æ–≤–∞–ª–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–æ–≥–∞—â–µ–Ω–∏–µ** (15 –º–∏–Ω—É—Ç)
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å—Ç—ã —Å —Ç–µ–≥–∞–º–∏
   docker compose exec -T supabase-db psql -U postgres -d postgres -c "
     SELECT COUNT(*) as posts_with_tags, 
            COUNT(CASE WHEN pe.tags::text LIKE '%longread%' THEN 1 END) as with_trigger_tags
     FROM posts p
     JOIN post_enrichment pe ON p.id = pe.post_id
     WHERE pe.tags IS NOT NULL;
   "
   ```
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –ø–æ—á–µ–º—É –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
   - –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Scheduler** (10 –º–∏–Ω—É—Ç)
   - –í—ã—è—Å–Ω–∏—Ç—å, –¥–æ–ª–∂–µ–Ω –ª–∏ –æ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∏–ª–∏ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ

5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–æ–≤** (5 –º–∏–Ω—É—Ç)
   ```bash
   docker compose exec worker curl -s http://qdrant:6333/health
   docker compose exec worker curl -s http://crawl4ai:8080/health
   ```

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

6. **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤**
   - –ê–ª–µ—Ä—Ç –ø—Ä–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏

7. **–£–ª—É—á—à–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –æ–±–æ–≥–∞—â–µ–Ω–∏—è**
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω –ø—Ä–æ–ø—É—Å–∫–∞ –æ–±–æ–≥–∞—â–µ–Ω–∏—è

8. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏**
   - Prometheus –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π, –ø–æ–≤—Ç–æ—Ä–∏—Ç—å E2E —Ç–µ—Å—Ç—ã:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã —Å–Ω–æ–≤–∞
docker compose exec -T worker python3 /app/check_pipeline_e2e.py --mode smoke --json
docker compose exec -T worker python3 /app/check_pipeline_e2e.py --mode e2e --json
docker compose exec -T worker python3 /app/check_pipeline_e2e.py --mode deep --json
```

–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- ‚úÖ –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤: –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–π—Ç–∏ (2560 = 2560)
- ‚ö†Ô∏è –û–±–æ–≥–∞—â–µ–Ω–∏–µ: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞–ª–∏—á–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–Ω—ã—Ö —Ç–µ–≥–æ–≤ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚ö†Ô∏è –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–æ–≤

---

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π**:
1. üî¥ –í—ã—Å–æ–∫–∏–π: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (–ø—Ä–æ–±–ª–µ–º–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É)
2. üü° –°—Ä–µ–¥–Ω–∏–π: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±–æ–≥–∞—â–µ–Ω–∏—è (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞, –Ω–æ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–∞)
3. üü¢ –ù–∏–∑–∫–∏–π: Scheduler (—Ä–∞–±–æ—Ç–∞–µ—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º)

