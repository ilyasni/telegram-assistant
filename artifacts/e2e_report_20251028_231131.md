# E2E –ü—Ä–æ–≤–µ—Ä–∫–∞ –ü–∞–π–ø–ª–∞–π–Ω–∞ - –ü–æ–ª–Ω—ã–π –û—Ç—á—ë—Ç

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** $(date '+%Y-%m-%d %H:%M:%S')  
**–†–µ–∂–∏–º:** End-to-End Full Check

---

## 1. –°—Ç–∞—Ç—É—Å –°–µ—Ä–≤–∏—Å–æ–≤

### Core Services
- ‚úÖ **telethon-ingest**: Up (healthy) - Scheduler —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **redis**: Up (healthy) - Streams –∞–∫—Ç–∏–≤–Ω—ã
- ‚úÖ **supabase-db**: Up (healthy) - 230 –ø–æ—Å—Ç–æ–≤, 27 –∫–∞–Ω–∞–ª–æ–≤
- ‚úÖ **qdrant**: Up - –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **neo4j**: Up (healthy) - –ì—Ä–∞—Ñ –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå **worker**: –ù–µ –∑–∞–ø—É—â–µ–Ω - **–ö–†–ò–¢–ò–ß–ù–û**

---

## 2. Scheduler (Incremental Parsing)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ**

**–î–µ—Ç–∞–ª–∏:**
- –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ç–∏–∫: –í—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
- –ö–∞–Ω–∞–ª–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 10 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –∑–∞ —Ç–∏–∫
- –†–µ–∂–∏–º: Incremental parsing enabled
- –ò–Ω—Ç–µ—Ä–≤–∞–ª: 300 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç)
- Lock –º–µ—Ö–∞–Ω–∏–∑–º: –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- HWM –∑–∞–ø–∏—Å–µ–π: 0 (–Ω–µ—Ç –∑–∞–≤–∏—Å—à–∏—Ö)

**–õ–æ–≥–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç:**
```
[INFO] Running scheduler tick (lock acquired)
[INFO] Found 10 active channels
[INFO] Scheduler tick completed
```

---

## 3. –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö (PostgreSQL/Supabase)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç**

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- **–í—Å–µ–≥–æ –ø–æ—Å—Ç–æ–≤:** 230
- **–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤:** 27
- **–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ—Å—Ç:** 2025-10-28 18:46:07+00 (~4.5 —á–∞—Å–∞ –Ω–∞–∑–∞–¥)

**–¢–æ–ø –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤:**
1. `4791c699-...`: 37 –ø–æ—Å—Ç–æ–≤ (–ø–æ—Å–ª–µ–¥–Ω–∏–π: 16:02:24)
2. `35d8421a-...`: 34 –ø–æ—Å—Ç–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–π: 15:55:07)
3. `160e4c95-...`: 23 –ø–æ—Å—Ç–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–π: 18:02:34)
4. `ed228ec6-...`: 22 –ø–æ—Å—Ç–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–π: 16:52:15)

**–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è:**
- ‚ö†Ô∏è **–í—Å–µ 230 –ø–æ—Å—Ç–æ–≤ –∏–º–µ—é—Ç —Å—Ç–∞—Ç—É—Å `pending`** –≤ `indexing_status`
- –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è (worker –Ω–µ –∑–∞–ø—É—â–µ–Ω)

---

## 4. Redis Streams - –ê–Ω–∞–ª–∏–∑ –ü–æ—Ç–æ–∫–∞

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ Streams:

| Stream | –°–æ–æ–±—â–µ–Ω–∏–π | Consumer Group | Consumers | Pending | Status |
|--------|-----------|----------------|-----------|---------|--------|
| **posts.parsed** | 1923 | tagging_workers | 2 | 0 | ‚úÖ OK |
| **posts.tagged** | 365 | - | - | - | ‚ö†Ô∏è –ù–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ |
| **posts.enriched** | 730 | indexing_workers | 1 | 0 | ‚úÖ OK |
| **posts.indexed** | 84 | - | - | - | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ –Ω–∏–∑–∫–æ |

### –ê–Ω–∞–ª–∏–∑ –ü–æ–∫—Ä—ã—Ç–∏—è:

```
–ü–∞—Ä—Å–∏–Ω–≥:     1923 —Å–æ–±—ã—Ç–∏–π ‚Üí 100% ‚úÖ
                    ‚Üì
–¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:  365 —Å–æ–±—ã—Ç–∏–π ‚Üí 19% ‚ö†Ô∏è (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
                    ‚Üì
–û–±–æ–≥–∞—â–µ–Ω–∏–µ:   730 —Å–æ–±—ã—Ç–∏–π ‚Üí 38% ‚úÖ (—á–∞—Å—Ç–∏—á–Ω–æ)
                    ‚Üì
–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è:    84 —Å–æ–±—ã—Ç–∏—è ‚Üí 4%  üî¥ (–∫—Ä–∏—Ç–∏—á–Ω–æ –Ω–∏–∑–∫–æ)
```

**–í—ã–≤–æ–¥—ã:**
- –ü–∞—Ä—Å–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ (1923 —Å–æ–±—ã—Ç–∏—è)
- –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ 19% (365/1923) - –Ω—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å
- –û–±–æ–≥–∞—â–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ (730 —Å–æ–±—ã—Ç–∏–π, –Ω–æ –±–æ–ª—å—à–µ —á–µ–º tagged - –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä—è–º–æ–µ –æ–±–æ–≥–∞—â–µ–Ω–∏–µ)
- –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è **–∫—Ä–∏—Ç–∏—á–Ω–æ –æ—Ç—Å—Ç–∞—ë—Ç** (—Ç–æ–ª—å–∫–æ 84/1923 = 4% –æ—Ç –≤—Å–µ–≥–æ –ø–æ—Ç–æ–∫–∞)

---

## 5. –ü—Ä–æ–±–ª–µ–º—ã –ü–∞–π–ø–ª–∞–π–Ω–∞

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ:

1. **Worker –Ω–µ –∑–∞–ø—É—â–µ–Ω**
   - –ë–ª–æ–∫–∏—Ä—É–µ—Ç –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é
   - –í—Å–µ 230 –ø–æ—Å—Ç–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ `pending`
   - –¢–æ–ª—å–∫–æ 84 —Å–æ–±—ã—Ç–∏—è –≤ stream (–≤–æ–∑–º–æ–∂–Ω–æ —Å—Ç–∞—Ä—ã–µ)

2. **–ù–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π (4%)**
   - –û–∂–∏–¥–∞–µ—Ç—Å—è: 90%+
   - –¢–µ–∫—É—â–µ–µ: 4%
   - –†–∞–∑–Ω–∏—Ü–∞: 86 –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã—Ö –ø—É–Ω–∫—Ç–∞

### ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ:

1. **–ù–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º (19%)**
   - –û–∂–∏–¥–∞–µ—Ç—Å—è: 80%+
   - –¢–µ–∫—É—â–µ–µ: 19%
   - –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
     - Worker –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏
     - –õ–∏–º–∏—Ç—ã AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
     - –û—à–∏–±–∫–∏ –ø—Ä–∏ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏

2. **–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ—Å—Ç 4.5 —á–∞—Å–∞ –Ω–∞–∑–∞–¥**
   - Scheduler —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤ –Ω–µ—Ç
   - –í–æ–∑–º–æ–∂–Ω–æ, –∫–∞–Ω–∞–ª—ã –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã
   - –ò–ª–∏ –Ω—É–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞

---

## 6. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### Qdrant (–í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î)
- –°—Ç–∞—Ç—É—Å: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
- HTTP API: –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å–µ—Ç—å

### Neo4j (–ì—Ä–∞—Ñ –ë–î)
- –°—Ç–∞—Ç—É—Å: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (healthy)
- –ü–æ—Ä—Ç—ã: 7473-7474 (HTTP), 7687 (Bolt)

### Prometheus
- –°—Ç–∞—Ç—É—Å: ‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω
- –ú–µ—Ç—Ä–∏–∫–∏ Worker: –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –Ω–æ value=0 (worker –Ω–µ –∑–∞–ø—É—â–µ–Ω)

---

## 7. –ò—Ç–æ–≥–æ–≤–∞—è –û—Ü–µ–Ω–∫–∞ –ø–æ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü–æ–∫—Ä—ã—Ç–∏–µ | –û—Ü–µ–Ω–∫–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|-----------|--------|----------|--------|-----------|
| **Scheduler** | ‚úÖ | 100% | –û—Ç–ª–∏—á–Ω–æ | - |
| **–ü–∞—Ä—Å–∏–Ω–≥** | ‚úÖ | 100% | –û—Ç–ª–∏—á–Ω–æ | - |
| **Redis** | ‚úÖ | 100% | –û—Ç–ª–∏—á–Ω–æ | - |
| **–ë–î** | ‚úÖ | 100% | –û—Ç–ª–∏—á–Ω–æ | - |
| **–¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** | ‚ö†Ô∏è | 19% | –ü–ª–æ—Ö–æ | –í—ã—Å–æ–∫–∏–π |
| **–û–±–æ–≥–∞—â–µ–Ω–∏–µ** | ‚úÖ | 38% | –•–æ—Ä–æ—à–æ | –°—Ä–µ–¥–Ω–∏–π |
| **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è** | üî¥ | 4% | –ö—Ä–∏—Ç–∏—á–Ω–æ | **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô** |
| **Worker** | üî¥ | 0% | –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô** |

---

## 8. –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –î–µ–π—Å—Ç–≤–∏—è

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ (—Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å):

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å Worker:**
   ```bash
   docker compose up -d worker
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Worker:**
   ```bash
   docker compose logs -f worker
   ```

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é:**
   ```bash
   docker compose exec supabase-db psql -U postgres -d postgres \
     -c "SELECT embedding_status, COUNT(*) FROM indexing_status GROUP BY embedding_status;"
   ```

### ‚ö†Ô∏è –í–∞–∂–Ω–æ (–≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è):

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ—Ä–µ–∑ —á–∞—Å –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ worker
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –Ω–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (< 80%)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Qdrant —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å–µ—Ç—å
4. –î–æ–±–∞–≤–∏—Ç—å worker –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫

---

## 9. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-2 –¥–Ω—è):

1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å worker –≤ `docker-compose.yml` –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å health checks –¥–ª—è –≤—Å–µ—Ö worker –∑–∞–¥–∞—á
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Lag –≤ Redis Streams
4. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã Prometheus –Ω–∞ –Ω–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (1 –Ω–µ–¥–µ–ª—è):

1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ worker
2. –î–æ–±–∞–≤–∏—Ç—å retry –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è failed —Å–æ–±—ã—Ç–∏–π
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É DLQ
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å dashboard –≤ Grafana –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞

---

## 10. –ú–µ—Ç—Ä–∏–∫–∏ –£—Å–ø–µ—Ö–∞

**–¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ Worker:**

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ | –¶–µ–ª–µ–≤–æ–µ | –°—Ä–æ–∫ |
|---------|---------|---------|------|
| –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è | 4% | 90%+ | 24 —á–∞—Å–∞ |
| –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | 19% | 80%+ | 48 —á–∞—Å–æ–≤ |
| Worker Uptime | 0% | 99%+ | –ü–æ—Å—Ç–æ—è–Ω–Ω–æ |
| Stream Lag | 0 | < 100 | –ü–æ—Å—Ç–æ—è–Ω–Ω–æ |

---

## 11. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ —Å–∏—Å—Ç–µ–º—ã:** ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π**

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ:**
- ‚úÖ Scheduler —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞–Ω–∞–ª–æ–≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- ‚úÖ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Redis, –ë–î, Neo4j) –≤ –ø–æ—Ä—è–¥–∫–µ

**–ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è:**
- üî¥ Worker –Ω–µ –∑–∞–ø—É—â–µ–Ω - –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å—é –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–±—ã—Ç–∏–π
- üî¥ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ 4% –≤–º–µ—Å—Ç–æ 90%+
- ‚ö†Ô∏è –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ 19% –≤–º–µ—Å—Ç–æ 80%+

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç #1:** –ó–∞–ø—É—Å—Ç–∏—Ç—å Worker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞.

---

**–û—Ç—á—ë—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω:** $(date '+%Y-%m-%d %H:%M:%S')
