# E2E –ü—Ä–æ–≤–µ—Ä–∫–∞ –ü–∞–π–ø–ª–∞–π–Ω–∞ - –ü–æ–ª–Ω—ã–π –û—Ç—á—ë—Ç

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** $(date '+%Y-%m-%d %H:%M:%S')  
**–†–µ–∂–∏–º:** End-to-End Full Check

---

## 1. –°—Ç–∞—Ç—É—Å –°–µ—Ä–≤–∏—Å–æ–≤

### Core Services
- ‚úÖ **telethon-ingest**: Up 3 minutes (healthy)
- ‚úÖ **redis**: Up 6 days (healthy)
- ‚úÖ **supabase-db**: Up 4 days (healthy)
- ‚úÖ **qdrant**: Up 6 days
- ‚úÖ **neo4j**: Up 3 days (healthy)

### Worker Services
- ‚ùì **worker**: –ù–µ –∑–∞–ø—É—â–µ–Ω (–æ–∂–∏–¥–∞–µ—Ç—Å—è –∑–∞–ø—É—Å–∫ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é)

---

## 2. Scheduler (Incremental Parsing)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

**–î–µ—Ç–∞–ª–∏:**
- –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ç–∏–∫: –í—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
- –ö–∞–Ω–∞–ª–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 10 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
- –†–µ–∂–∏–º: Incremental parsing enabled
- –ò–Ω—Ç–µ—Ä–≤–∞–ª: 300 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç)
- Lock –º–µ—Ö–∞–Ω–∏–∑–º: –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–õ–æ–≥–∏:**
```
[INFO] Running scheduler tick (lock acquired)
[INFO] Found 10 active channels
[INFO] Scheduler tick completed
```

**HWM (High Water Mark):**
- HWM –∑–∞–ø–∏—Å–µ–π –≤ Redis: 0 (–Ω–µ—Ç –∑–∞–≤–∏—Å—à–∏—Ö HWM)

---

## 3. –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö (PostgreSQL/Supabase)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å—Ç–æ–≤:**
- –í—Å–µ–≥–æ –ø–æ—Å—Ç–æ–≤: 230
- –ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤: 27
- –ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ—Å—Ç: 2025-10-28 18:46:07+00 (–æ–∫–æ–ª–æ 4.5 —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥)

**–¢–æ–ø –∫–∞–Ω–∞–ª–æ–≤ –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10):**
- –ö–∞–Ω–∞–ª `a5f1157f-...`: 10 –ø–æ—Å—Ç–æ–≤, –ø–æ—Å–ª–µ–¥–Ω–∏–π: 2025-10-28 18:46:07+00
- –ö–∞–Ω–∞–ª `160e4c95-...`: 23 –ø–æ—Å—Ç–∞, –ø–æ—Å–ª–µ–¥–Ω–∏–π: 2025-10-28 18:02:34+00
- –ö–∞–Ω–∞–ª `ed228ec6-...`: 22 –ø–æ—Å—Ç–∞, –ø–æ—Å–ª–µ–¥–Ω–∏–π: 2025-10-28 16:52:15+00
- –ö–∞–Ω–∞–ª `4791c699-...`: 37 –ø–æ—Å—Ç–æ–≤, –ø–æ—Å–ª–µ–¥–Ω–∏–π: 2025-10-28 16:02:24+00
- –ò –¥—Ä—É–≥–∏–µ...

**–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è:**
- –í—Å–µ –ø–æ—Å—Ç—ã (230) –∏–º–µ—é—Ç —Å—Ç–∞—Ç—É—Å `pending` –¥–ª—è embedding –∏ graph
- –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –µ—â—ë –Ω–µ –Ω–∞—á–∞–ª–∞—Å—å –∏–ª–∏ worker –Ω–µ –∑–∞–ø—É—â–µ–Ω

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è Collation version mismatch (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

---

## 4. Redis Streams

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

### Streams –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:

#### stream:posts:parsed
- **–î–ª–∏–Ω–∞:** 1923 —Å–æ–æ–±—â–µ–Ω–∏—è
- **Consumer Group:** `tagging_workers`
- **Consumers:** 2 –∞–∫—Ç–∏–≤–Ω—ã—Ö
- **Pending:** 0 (–≤—Å–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã)
- **Last delivered ID:** 1761592956987-0
- **Entries read:** 570

**–í—ã–≤–æ–¥:** –ü–∞—Ä—Å–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ—Å—Ç—ã –ø–æ–ø–∞–¥–∞—é—Ç –≤ –ø–æ—Ç–æ–∫

#### stream:posts:tagged
- **–î–ª–∏–Ω–∞:** 365 —Å–æ–æ–±—â–µ–Ω–∏–π

**–í—ã–≤–æ–¥:** –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –º–µ–Ω—å—à–µ –ø–æ—Å—Ç–æ–≤ —á–µ–º –ø–∞—Ä—Å–∏—Ç—Å—è (365 vs 1923)

#### stream:posts:enriched
- **–î–ª–∏–Ω–∞:** 730 —Å–æ–æ–±—â–µ–Ω–∏–π
- **Consumer Group:** `indexing_workers`
- **Consumers:** 1 –∞–∫—Ç–∏–≤–Ω—ã–π
- **Pending:** 0 (–≤—Å–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã)
- **Last delivered ID:** 1761592957071-0
- **Entries read:** 730

**–í—ã–≤–æ–¥:** –û–±–æ–≥–∞—â–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

#### stream:posts:indexed
- **–î–ª–∏–Ω–∞:** 84 —Å–æ–æ–±—â–µ–Ω–∏—è

**–í—ã–≤–æ–¥:** –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å –æ–±–æ–≥–∞—â—ë–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤ (84 vs 730)

---

## 5. –ü–∞–π–ø–ª–∞–π–Ω –û–±—Ä–∞–±–æ—Ç–∫–∏ –°–æ–±—ã—Ç–∏–π

### –ê–Ω–∞–ª–∏–∑ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö:

1. **–ü–∞—Ä—Å–∏–Ω–≥ (posts.parsed)**: ‚úÖ 1923 —Å–æ–±—ã—Ç–∏—è
2. **–¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (posts.tagged)**: ‚úÖ 365 —Å–æ–±—ã—Ç–∏–π (19% –æ—Ç parsed)
3. **–û–±–æ–≥–∞—â–µ–Ω–∏–µ (posts.enriched)**: ‚úÖ 730 —Å–æ–±—ã—Ç–∏–π (38% –æ—Ç parsed, 200% –æ—Ç tagged)
4. **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è (posts.indexed)**: ‚úÖ 84 —Å–æ–±—ã—Ç–∏—è (4% –æ—Ç parsed, 12% –æ—Ç enriched)

### –ü—Ä–æ–±–ª–µ–º—ã –ø–∞–π–ø–ª–∞–π–Ω–∞:

‚ö†Ô∏è **–ù–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º:**
- –¢–æ–ª—å–∫–æ 365 –∏–∑ 1923 –ø–æ—Å—Ç–æ–≤ –ø—Ä–æ—Ç–µ–≥–∏—Ä–æ–≤–∞–Ω—ã (19%)
- –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
  - Worker –¥–ª—è —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –∑–∞–ø—É—â–µ–Ω –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
  - –õ–∏–º–∏—Ç—ã AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (GigaChat/OpenRouter)
  - –û—à–∏–±–∫–∏ –ø—Ä–∏ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏

‚ö†Ô∏è **–ù–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π:**
- –¢–æ–ª—å–∫–æ 84 –∏–∑ 730 –æ–±–æ–≥–∞—â—ë–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω—ã (12%)
- –í—Å–µ –ø–æ—Å—Ç—ã –≤ –ë–î –∏–º–µ—é—Ç —Å—Ç–∞—Ç—É—Å `pending` –≤ `indexing_status`
- –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
  - Worker –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
  - –ü—Ä–æ–±–ª–µ–º—ã —Å Qdrant –∏–ª–∏ Neo4j
  - –û—à–∏–±–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

---

## 6. Qdrant

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–µ—Ä–µ–∑ HTTP API

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –ø—Ä—è–º–æ–π HTTP –∑–∞–ø—Ä–æ—Å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç. –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å–µ—Ç—å Docker.

---

## 7. Neo4j

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç (healthy)

**–î–µ—Ç–∞–ª–∏:**
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä: Up 3 days (healthy)
- –ü–æ—Ä—Ç—ã: 7473-7474 (HTTP/HTTPS), 7687 (Bolt)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Python –∫–ª–∏–µ–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —É–∑–ª–æ–≤

---

## 8. Prometheus Metrics

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω

**–ú–µ—Ç—Ä–∏–∫–∏:**
- Worker job: –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ 0 (worker –Ω–µ –∑–∞–ø—É—â–µ–Ω)

---

## 9. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ü—Ä–æ–±–ª–µ–º—ã

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ:

1. **Worker –Ω–µ –∑–∞–ø—É—â–µ–Ω**
   - –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
   - –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
   - –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è

2. **–ù–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π**
   - –¢–æ–ª—å–∫–æ 12% –æ–±–æ–≥–∞—â—ë–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω—ã
   - –í—Å–µ 230 –ø–æ—Å—Ç–æ–≤ –≤ –ë–î –∏–º–µ—é—Ç —Å—Ç–∞—Ç—É—Å `pending` –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

### ‚ö†Ô∏è –í–∞–∂–Ω–æ:

1. **–ù–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º**
   - –¢–æ–ª—å–∫–æ 19% –ø–∞—Ä—Å–µ–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤ –ø—Ä–æ—Ç–µ–≥–∏—Ä–æ–≤–∞–Ω—ã
   - –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É tagging worker

2. **Qdrant –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è HTTP –ø—Ä–æ–≤–µ—Ä–∫–∏**
   - –ù—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

---

## 10. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:

1. ‚úÖ **–ó–∞–ø—É—Å—Ç–∏—Ç—å Worker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:**
   ```bash
   docker compose up -d worker
   ```

2. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Worker –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:**
   ```bash
   docker compose logs -f worker
   ```

3. ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é:**
   ```bash
   docker compose exec supabase-db psql -U postgres -d postgres -c "SELECT embedding_status, COUNT(*) FROM indexing_status GROUP BY embedding_status;"
   ```

4. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Qdrant –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:**
   ```bash
   docker compose exec qdrant curl http://localhost:6333/health
   ```

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ Worker –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã
2. –î–æ–±–∞–≤–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –Ω–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —ç—Ç–∞–ø–æ–≤ –ø–∞–π–ø–ª–∞–π–Ω–∞
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Lag –≤ Redis Streams
4. –î–æ–±–∞–≤–∏—Ç—å health checks –¥–ª—è –≤—Å–µ—Ö worker –∑–∞–¥–∞—á

---

## 11. –ò—Ç–æ–≥–æ–≤–∞—è –û—Ü–µ–Ω–∫–∞

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü–æ–∫—Ä—ã—Ç–∏–µ | –û—Ü–µ–Ω–∫–∞ |
|-----------|--------|----------|--------|
| Scheduler | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 100% | –û—Ç–ª–∏—á–Ω–æ |
| –ü–∞—Ä—Å–∏–Ω–≥ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 100% | –û—Ç–ª–∏—á–Ω–æ |
| –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | 19% | –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è |
| –û–±–æ–≥–∞—â–µ–Ω–∏–µ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 38% | –•–æ—Ä–æ—à–æ |
| –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è | üî¥ –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | 12% | –ö—Ä–∏—Ç–∏—á–Ω–æ |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π**

**–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** Worker –Ω–µ –∑–∞–ø—É—â–µ–Ω, —á—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –∏ —Å–Ω–∏–∂–∞–µ—Ç –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

---

**–û—Ç—á—ë—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω:** $(date '+%Y-%m-%d %H:%M:%S')

