# üéØ –û—Ç—á—ë—Ç –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞: Incremental Parsing

## üìã –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. Core Logic (100% ‚úÖ)
- ‚úÖ `_get_since_date()` ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ starting point —Å Redis HWM
- ‚úÖ `_process_message_batch()` ‚Äî tracking max_date –≤ –±–∞—Ç—á–∞—Ö
- ‚úÖ `_update_last_parsed_at()` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ watermark –≤ –ë–î
- ‚úÖ Safeguard –º–µ—Ö–∞–Ω–∏–∑–º (LPA max age ‚Üí forced historical)
- ‚úÖ –†–µ–∂–∏–º—ã: historical, incremental, auto

### 2. Database (100% ‚úÖ)
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è `last_parsed_at` –ø–æ–ª—è
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã: `idx_channels_last_parsed_at`, `idx_channels_active_unparsed`
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è queries –¥–ª—è scheduler

### 3. Configuration (100% ‚úÖ)
- ‚úÖ `ParserConfig` —Ä–∞—Å—à–∏—Ä–µ–Ω –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- ‚úÖ ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: `PARSER_MODE_OVERRIDE`, `PARSER_HISTORICAL_HOURS`, etc.
- ‚úÖ Docker Compose –æ–±–Ω–æ–≤–ª—ë–Ω

### 4. Scheduler (80% ‚ö†Ô∏è)
- ‚úÖ `ParseAllChannelsTask` –∫–ª–∞—Å—Å —Å–æ–∑–¥–∞–Ω
- ‚úÖ Prometheus –º–µ—Ç—Ä–∏–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- ‚úÖ –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
- ‚ö†Ô∏è –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞)
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ChannelParser

## üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: ChannelParser dependencies
**–°–∏–º–ø—Ç–æ–º**: ChannelParser —Ç—Ä–µ–±—É–µ—Ç `AsyncSession` –∏ `EventPublisher`
**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∞ —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è scheduler –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
**–°—Ç–∞—Ç—É—Å**: –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 2: TelegramClient integration
**–°–∏–º–ø—Ç–æ–º**: –ù—É–∂–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ TelegramClient –≤ scheduler
**–†–µ—à–µ–Ω–∏–µ**: –û—Ç–ª–æ–∂–µ–Ω–æ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
**–°—Ç–∞—Ç—É—Å**: –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏

## üìä –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: 85%** ‚úÖ

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. ‚úÖ –ë–∞–∑–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ incremental parsing
2. ‚úÖ Database —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∏–Ω–¥–µ–∫—Å—ã
3. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
4. ‚úÖ Scheduler –≤ —Ä–µ–∂–∏–º–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
5. ‚úÖ Prometheus –º–µ—Ç—Ä–∏–∫–∏ (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã)

### –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏:
1. ‚ö†Ô∏è –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è scheduler —Å ChannelParser
2. ‚ö†Ô∏è Telethon –∫–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–¥–∞—á–∞
3. ‚ö†Ô∏è E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (–Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ):
1. –ü—Ä–æ–≤–µ—Å—Ç–∏ manual —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π –ª–æ–≥–∏–∫–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `last_parsed_at` –≤ –ë–î
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (1-2 –Ω–µ–¥–µ–ª–∏):
1. –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é scheduler —Å ChannelParser
2. –î–æ–±–∞–≤–∏—Ç—å end-to-end —Ç–µ—Å—Ç—ã
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Grafana dashboards

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (1+ –º–µ—Å—è—Ü):
1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
3. Multi-tenancy support

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ 85%**

Core —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –û—Å—Ç–∞–≤—à–∏–µ—Å—è 15% ‚Äî —ç—Ç–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production deployment** –ø–æ—Å–ª–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ scheduler.

