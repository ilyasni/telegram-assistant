{
    # Глобальные настройки
    log {
        output stdout
        format json
    }
    # Отключаем автоматический HTTPS для разработки
    auto_https off
}

# Единый домен с path-based маршрутизацией (Production)
:80 {
    # Supabase Studio (внешний доступ)
    handle_path /supabase/* {
        reverse_proxy supabase-studio:3000
    }

    # Grafana Dashboard (внешний доступ)
    handle_path /grafana/* {
        reverse_proxy grafana:3000
    }

    # Health check
    handle /health {
        respond "OK" 200
    }

    # Root endpoint
    handle / {
        respond "Telegram Assistant API Gateway" 200
    }
}

# Внутренние сервисы (только для Docker сети)
# API Gateway
api:8000 {
    reverse_proxy api:8000
}

# Neo4j Browser
neo4j:7474 {
    reverse_proxy neo4j:7474
}

# Qdrant Dashboard
qdrant:6333 {
    reverse_proxy qdrant:6333
}

# RAG Service
rag:8000 {
    reverse_proxy api:8000
}
