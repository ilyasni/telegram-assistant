# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞ –∞–ª—å–±–æ–º–æ–≤ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–î–∞—Ç–∞**: 2025-01-30

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

–ü—Ä–æ–≤–µ–¥–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–∞ –∞–ª—å–±–æ–º–æ–≤ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ ingestion.

## –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã

### –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
- ‚úÖ –ù–∞–π–¥–µ–Ω–æ **39 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤** –≤ –ë–î
- ‚úÖ –í—Å–µ –∫–∞–Ω–∞–ª—ã –∏–º–µ—é—Ç `is_active = true`
- ‚úÖ –ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω—è–ª—Å—è: 2025-11-02 21:47:51

### –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–∞

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- `media_groups`: 0 –∑–∞–ø–∏—Å–µ–π (–∞–ª—å–±–æ–º—ã –µ—â—ë –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã)
- `media_group_items`: 0 –∑–∞–ø–∏—Å–µ–π
- –ú–∏–≥—Ä–∞—Ü–∏—è `004_add_album_fields.sql` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∞

#### Redis Streams
- `stream:albums:parsed`: 0 —Å–æ–±—ã—Ç–∏–π
- `stream:album:assembled`: 0 —Å–æ–±—ã—Ç–∏–π
- `album:state:*`: 0 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

#### Worker
- ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ healthy
- ‚ö†Ô∏è  –ú–µ—Ç—Ä–∏–∫–∏ album –ø–æ–∫–∞ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã (–∞–ª—å–±–æ–º—ã –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã)

## –ü—Ä–æ—Ü–µ—Å—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
docker exec telegram-assistant-supabase-db-1 psql -U postgres -d postgres -c "
SELECT id, username, title, is_active, last_parsed_at 
FROM channels 
WHERE is_active = true 
ORDER BY created_at DESC 
LIMIT 10;
"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ 39 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```bash
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–ª—å–±–æ–º–æ–≤
docker exec telegram-assistant-supabase-db-1 psql -U postgres -d postgres -c "
SELECT COUNT(*) FROM media_groups;
"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 0 –∞–ª—å–±–æ–º–æ–≤ (–æ–∂–∏–¥–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞)

### 3. –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞

```bash
# –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–∞–Ω–∞–ª–∞
docker exec telegram-assistant-telethon-ingest-1 python -m scripts.manual_parse_channel \
  --username business_ru --mode incremental
```

**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è  –¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–∞–Ω–∞–ª–∞–º–∏

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î** (–µ—Å–ª–∏ –µ—â—ë –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞):
   ```bash
   docker exec telegram-assistant-supabase-db-1 psql -U postgres -d postgres \
     -f /opt/telegram-assistant/telethon-ingest/migrations/004_add_album_fields.sql
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –∫–∞–Ω–∞–ª–æ–≤ —Å –∞–ª—å–±–æ–º–∞–º–∏**:
   ```bash
   # Scheduler –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ telethon-ingest
   # –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
   docker exec telegram-assistant-telethon-ingest-1 python -m scripts.manual_parse_channel \
     --username <channel_username> --mode incremental
   ```

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**:
   ```bash
   # –õ–æ–≥–∏ ingestion
   docker logs telegram-assistant-telethon-ingest-1 -f | grep -i "album\|media_group"
   
   # –õ–æ–≥–∏ worker
   docker logs telegram-assistant-worker-1 -f | grep -i "album"
   
   # –ú–µ—Ç—Ä–∏–∫–∏
   watch -n 5 'curl -s http://localhost:8001/metrics | grep -E "^albums_|^album_"'
   ```

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–∞–Ω–∞–ª–∞ —Å –∞–ª—å–±–æ–º–∞–º–∏:

1. ‚úÖ –í –ë–î –ø–æ—è–≤—è—Ç—Å—è –∑–∞–ø–∏—Å–∏ –≤ `media_groups`
2. ‚úÖ –í Redis Streams –ø–æ—è–≤—è—Ç—Å—è —Å–æ–±—ã—Ç–∏—è `albums.parsed`
3. ‚úÖ Worker –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏ —Å–æ–∑–¥–∞—Å—Ç `album.assembled`
4. ‚úÖ –í –º–µ—Ç—Ä–∏–∫–∞—Ö –ø–æ—è–≤—è—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è `albums_parsed_total`, `albums_assembled_total`

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
2. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –∫–∞–Ω–∞–ª–∞ —Å –∞–ª—å–±–æ–º–∞–º–∏
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∞–ª—å–±–æ–º–æ–≤ –≤ –ë–î
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏—è –≤ Redis Streams
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É –∞–ª—å–±–æ–º–æ–≤ –≤ album_assembler_task
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ vision summary –≤ S3/–ë–î
7. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –≤ Qdrant/Neo4j

## –í—ã–≤–æ–¥—ã

- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∞–ª—å–±–æ–º–æ–≤
- ‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∑–∞–ø—É—â–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–∞–Ω–∞–ª–∞–º–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—é –º–µ—Ç—Ä–∏–∫

**–°—Ç–∞—Ç—É—Å**: üü° **–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**

