# –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–î–∞—Ç–∞**: 2025-02-02  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏
- ‚úÖ **–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ –±–æ—Ç–∞** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `api/tasks/scheduler_tasks.py`
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ RAG –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –∏—Å—Ç–æ—Ä–∏—é** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `api/services/rag_service.py`

### 2. –°—Ä–µ–¥–Ω–∏–µ –∑–∞–¥–∞—á–∏
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `api/routers/rag.py`
- ‚úÖ **DLQ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `api/tasks/scheduler_tasks.py`
- ‚úÖ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ç—Ä–µ–Ω–¥–∞—Ö** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `api/tasks/scheduler_tasks.py`

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `pydantic` –¥–æ –≤–µ—Ä—Å–∏–∏ `>=2.7.4,<3.0.0` –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å `langchain`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `aiogram` –¥–æ –≤–µ—Ä—Å–∏–∏ `>=3.13.0` –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å `pydantic 2.7+`
- ‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, –≤–∫–ª—é—á–∞—è `qdrant-client`

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –°–µ—Ä–≤–∏—Å—ã
- ‚úÖ **API**: Up (healthy) - –≤—Å–µ –º–æ–¥—É–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
- ‚úÖ **Qdrant**: Up - –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **Redis**: Up (healthy) - –∫—ç—à –∏ streams —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ **PostgreSQL**: Up (healthy) - –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ **Neo4j**: Up (healthy) - –≥—Ä–∞—Ñ–æ–≤–∞—è –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **Worker**: Up (healthy) - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **Telethon-ingest**: Up (healthy) - –ø–∞—Ä—Å–∏–Ω–≥ –∫–∞–Ω–∞–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª–µ–π
- ‚úÖ `qdrant-client` - —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ `RAG Service` - –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ `Scheduler` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
- ‚úÖ `Digest Service` - –≥–æ—Ç–æ–≤ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤
- ‚úÖ `Trend Detection Service` - –≥–æ—Ç–æ–≤ –∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—é —Ç—Ä–µ–Ω–¥–æ–≤
- ‚úÖ `Graph Service` - –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ —Å Neo4j

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã**: `digest_settings`, `digest_history`, `rag_query_history`, `trends_detection`, `trend_alerts`, `user_interests`
- ‚úÖ **pgvector extension**: —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–≤–µ—Ä—Å–∏—è 0.7.0)
- ‚úÖ **–ü–æ—Å—Ç—ã –≤ –ë–î**: 218 –ø–æ—Å—Ç–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ **Digest settings**: 0 (–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —á–µ—Ä–µ–∑ API)
- ‚úÖ **Active trends**: 0 (–±—É–¥–µ—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∑–∞–¥–∞—á–∏)

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### 1. RAG Service
```bash
# –¢–µ—Å—Ç RAG –∑–∞–ø—Ä–æ—Å–∞
curl -X POST http://localhost:8000/api/rag/query \
  -H "Content-Type: application/json" \
  -d '{
    "query": "–ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ AI?",
    "user_id": "your-user-id"
  }'
```

### 2. Digest Service
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–∞–π–¥–∂–µ—Å—Ç–∞
curl -X PUT http://localhost:8000/api/digest/settings/{user_id} \
  -H "Content-Type: application/json" \
  -d '{
    "enabled": true,
    "topics": ["AI", "–º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ"],
    "frequency": "daily",
    "schedule_time": "09:00",
    "schedule_tz": "Europe/Moscow"
  }'

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–π–¥–∂–µ—Å—Ç–∞
curl -X POST http://localhost:8000/api/digest/generate/{user_id}
```

### 3. Trend Detection
```bash
# –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤
curl -X POST "http://localhost:8000/api/trends/detect?days=7"

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤
curl "http://localhost:8000/api/trends/?min_frequency=10&min_engagement=5.0"

# –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Ç—Ä–µ–Ω–¥–æ–≤
curl "http://localhost:8000/api/trends/{trend_id}/similar?limit=10&threshold=0.7"
```

### 4. Voice Transcription
- –û—Ç–ø—Ä–∞–≤–∫–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ SaluteSpeech
- –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω —á–µ—Ä–µ–∑ RAG Service

### 5. Scheduled Tasks
- ‚úÖ **–î–∞–π–¥–∂–µ—Å—Ç—ã**: –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- ‚úÖ **–¢—Ä–µ–Ω–¥—ã**: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 00:00 UTC
- ‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤**: –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç (PostgreSQL ‚Üí Neo4j)

## üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –õ–æ–≥–∏
```bash
# –õ–æ–≥–∏ API
docker compose logs -f api

# –õ–æ–≥–∏ Scheduler
docker compose logs api | grep -i scheduler

# –õ–æ–≥–∏ –æ—à–∏–±–æ–∫
docker compose logs api | grep -iE "error|exception"
```

### Health checks
```bash
# –û–±—â–∏–π health
curl http://localhost:8000/health

# Health API
curl http://localhost:8000/api/health

# Health –±–æ—Ç–∞
curl http://localhost:8000/health/bot
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü
docker compose exec supabase-db psql -U postgres -d postgres -c "\dt"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ digest settings
docker compose exec supabase-db psql -U postgres -d postgres -c "SELECT * FROM digest_settings;"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–Ω–¥–æ–≤
docker compose exec supabase-db psql -U postgres -d postgres -c "SELECT * FROM trends_detection WHERE status = 'active' LIMIT 5;"
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **GigaChat credentials**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `.env` –∑–∞–ø–æ–ª–Ω–µ–Ω—ã `GIGACHAT_CREDENTIALS` –∏ `GIGACHAT_SCOPE`
2. **SaluteSpeech credentials**: –î–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞–ø–æ–ª–Ω–∏—Ç–µ `SALUTESPEECH_CLIENT_ID` –∏ `SALUTESPEECH_CLIENT_SECRET`
3. **Telegram Bot Token**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `TELEGRAM_BOT_TOKEN` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
4. **Qdrant –∫–æ–ª–ª–µ–∫—Ü–∏–∏**: –ö–æ–ª–ª–µ–∫—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –ø–æ—Å—Ç–æ–≤

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–∞–π–¥–∂–µ—Å—Ç–∞
2. **–î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª—ã** –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥** –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å RAG** –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤** –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
6. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤** —á–µ—Ä–µ–∑ scheduled task

## ‚úÖ –ò—Ç–æ–≥

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.**

–í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∏ —Å—Ä–µ–¥–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

