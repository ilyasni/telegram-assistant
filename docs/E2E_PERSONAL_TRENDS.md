# E2E —Å—Ü–µ–Ω–∞—Ä–∏–π: –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã (per-user scope)

–¶–µ–ª—å: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç—Ä–µ–Ω–¥—ã —Ç–æ–ª—å–∫–æ –ø–æ —Å–≤–æ–∏–º –∫–∞–Ω–∞–ª–∞–º.

## –ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è
- –í –ë–î –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `users.id = <USER_UUID>` –∏ –µ–≥–æ –ø—Ä–∏–≤—è–∑–∫–∞ `identities.telegram_id = <TG_ID>`.
- –¢–∞–±–ª–∏—Ü–∞ `user_channel` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∞–∫—Ç–∏–≤–Ω—ã–π –∫–∞–Ω–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- –í `trend_cluster_posts` –µ—Å—Ç—å –ø–æ—Å—Ç—ã –∏–∑ –∫–∞–Ω–∞–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–æ—Å—Ç—ã –∏–∑ —á—É–∂–∏—Ö –∫–∞–Ω–∞–ª–æ–≤.

## –®–∞–≥–∏
1) API: GET `/api/trends/emerging?user_id=<USER_UUID>`
   - –û–∂–∏–¥–∞–Ω–∏–µ: –≤—Å–µ `clusters[*].card.example_posts[*].channel_id` ‚àà –º–Ω–æ–∂–µ—Å—Ç–≤–µ –∫–∞–Ω–∞–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
   - –û–∂–∏–¥–∞–Ω–∏–µ: `clusters` –ø—É—Å—Ç, –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –∫–∞–Ω–∞–ª–æ–≤.

2) API: GET `/api/trends/clusters?status=stable&user_id=<USER_UUID>`
   - –û–∂–∏–¥–∞–Ω–∏–µ: –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø.1.

3) API: GET `/api/trends/clusters/{cluster_id}?user_id=<USER_UUID>`
   - –û–∂–∏–¥–∞–Ω–∏–µ: –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤ –≤ –¥–∞–Ω–Ω–æ–º –∫–ª–∞—Å—Ç–µ—Ä–µ ‚Äî 404.

4) API: POST `/api/trends/summarize_cluster?user_id=<USER_UUID>` body: `{ "cluster_id": "<UUID>" }`
   - –û–∂–∏–¥–∞–Ω–∏–µ: `card.example_posts` —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ –∫–∞–Ω–∞–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

5) –ë–æ—Ç:
   - –ö–Ω–æ–ø–∫–∏ ¬´üî• –ì–æ—Ä—è—á–∏–µ¬ª –∏ ¬´üßä –£—Å—Ç–æ–π—á–∏–≤—ã–µ¬ª –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –ø–æ—Å—Ç–æ–≤ —Ç–æ–ª—å–∫–æ –∏–∑ –∫–∞–Ω–∞–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å
- Prometheus: `trends_personal_requests_total{endpoint, outcome}` –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö.

## –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –∫–µ–π—Å—ã
- `user_id` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞ (–∏–ª–∏ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤–∫–ª—é—á–∏—Ç—å RLS).
- –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 0 –∫–∞–Ω–∞–ª–æ–≤ ‚Üí –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–Ω–¥–æ–≤.


