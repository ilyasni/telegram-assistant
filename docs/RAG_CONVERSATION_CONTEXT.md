# –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –≤ RAG Service

**–î–∞—Ç–∞**: 2025-11-05  
**Context7**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è multi-turn conversations —Å —É—á–µ—Ç–æ–º –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤

---

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

**–ë—ã–ª–æ**: –ö–∞–∂–¥—ã–π RAG –∑–∞–ø—Ä–æ—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ, –±–µ–∑ —É—á–µ—Ç–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤.

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã**:
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ AI?
–ë–æ—Ç: [–û—Ç–≤–µ—Ç –ø—Ä–æ AI]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ê —á—Ç–æ –ø—Ä–æ –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ?
–ë–æ—Ç: [–û—Ç–≤–µ—Ç –ø—Ä–æ ML, –Ω–æ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–ø—Ä–∞—à–∏–≤–∞–ª –ø—Ä–æ AI]
```

**–ù—É–∂–Ω–æ**: –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–Ω–∏–º–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ —É—á–∏—Ç—ã–≤–∞—Ç—å –∏—Ö –ø—Ä–∏ –æ—Ç–≤–µ—Ç–µ.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞

**–ú–µ—Ç–æ–¥**: `_get_conversation_history()` –≤ `RAGService`

**–õ–æ–≥–∏–∫–∞**:
- –ü–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ `RAGQueryHistory`
- –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–º—É –æ–∫–Ω—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 24 —á–∞—Å–∞)
- –§–æ—Ä–º–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ `[{"role": "user", "content": "..."}, {"role": "assistant", "content": "..."}]`

**–ö–æ–¥**:
```python
async def _get_conversation_history(
    self,
    user_id: UUID,
    db: Session,
    max_turns: int = 5
) -> List[Dict[str, str]]:
    # –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ—Ç–≤–µ—Ç–∞–º–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ–∫–Ω–∞
    history_records = db.query(RAGQueryHistory).filter(
        RAGQueryHistory.user_id == user_id,
        RAGQueryHistory.response_text.isnot(None),
        RAGQueryHistory.created_at >= cutoff_time
    ).order_by(desc(RAGQueryHistory.created_at)).limit(max_turns).all()
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
    conversation = []
    for record in reversed(history_records):
        conversation.append({"role": "user", "content": record.query_text})
        conversation.append({"role": "assistant", "content": record.response_text[:1000]})
    
    return conversation
```

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ–º–ø—Ç—ã LangChain

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: `MessagesPlaceholder` –≤ `ChatPromptTemplate`

**–ü—Ä–æ–º–ø—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã**:
```python
ask_prompt = ChatPromptTemplate.from_messages([
    ("system", """–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑ Telegram –∫–∞–Ω–∞–ª–æ–≤.
...
–ï—Å–ª–∏ –µ—Å—Ç—å –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–π –µ—ë –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞."""),
    MessagesPlaceholder(variable_name="conversation_history", optional=True),
    ("human", "–ö–æ–Ω—Ç–µ–∫—Å—Ç:\n{context}\n\n–í–æ–ø—Ä–æ—Å: {query}\n\n–û—Ç–≤–µ—Ç:")
])
```

### 3. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ LangChain Messages

**–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ**: –°–ø–∏—Å–æ–∫ dict ‚Üí LangChain Message –æ–±—ä–µ–∫—Ç—ã

**–ö–æ–¥**:
```python
history_messages = []
if conversation_history:
    for msg in conversation_history:
        if msg.get("role") == "user":
            history_messages.append(HumanMessage(content=msg.get("content", "")))
        elif msg.get("role") == "assistant":
            history_messages.append(AIMessage(content=msg.get("content", "")))

router_input = {
    "query": query,
    "context": context,
    "intent": intent,
    "conversation_history": history_messages
}
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# RAG Conversation Context
RAG_CONVERSATION_HISTORY_ENABLED=true
RAG_MAX_CONVERSATION_TURNS=5  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä –≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç
RAG_CONVERSATION_WINDOW_HOURS=24  # –û–∫–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ (—á–∞—Å—ã)
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ—Ç–æ–¥–∞ `query()`

```python
result = await rag_service.query(
    query="–ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ AI?",
    user_id=user_id,
    tenant_id=tenant_id,
    db=db,
    include_conversation_history=True,  # –í–∫–ª—é—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
    max_conversation_turns=5  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä –≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç
)
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: Multi-turn conversation

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ AI?
–ë–æ—Ç: [–û—Ç–≤–µ—Ç –ø—Ä–æ AI —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ê —á—Ç–æ –ø—Ä–æ –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ?
–ë–æ—Ç: [–û—Ç–≤–µ—Ç –ø—Ä–æ ML, —É—á–∏—Ç—ã–≤–∞—è —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–ø—Ä–∞—à–∏–≤–∞–ª –ø—Ä–æ AI]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ
–ë–æ—Ç: [–û—Ç–≤–µ—Ç –ø—Ä–æ ML, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –±—ã–ª–æ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –≤–æ–ø—Ä–æ—Å–µ]
```

### –ü—Ä–∏–º–µ—Ä 2: –£—Ç–æ—á–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ö–∞–∫–∏–µ —Ç—Ä–µ–Ω–¥—ã –≤ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö?
–ë–æ—Ç: [–û—Ç–≤–µ—Ç –ø—Ä–æ —Ç—Ä–µ–Ω–¥—ã]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ê —á—Ç–æ –ø—Ä–æ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏?
–ë–æ—Ç: [–û—Ç–≤–µ—Ç –ø—Ä–æ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏, —É—á–∏—Ç—ã–≤–∞—è —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–ª –ø—Ä–æ —Ç—Ä–µ–Ω–¥—ã]
```

---

## üéØ Context7 Best Practices

### 1. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å—Ç–æ—Ä–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–π –∏ –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç —Ç–æ–∫–µ–Ω–æ–≤ LLM.

**–†–µ—à–µ–Ω–∏–µ**:
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø–∞—Ä –≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç (max_turns)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (conversation_window_hours)
- –û–±—Ä–µ–∑–∫–∞ –¥–ª–∏–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (response_text[:1000])

### 2. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ –≤—Å–µ–≥–¥–∞ –Ω—É–∂–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤).

**–†–µ—à–µ–Ω–∏–µ**:
- –ü–∞—Ä–∞–º–µ—Ç—Ä `include_conversation_history` –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `RAG_CONVERSATION_HISTORY_ENABLED` –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**:
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ `user_id` –∏ `created_at` –≤ `RAGQueryHistory`
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π —á–µ—Ä–µ–∑ `limit(max_turns)`
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–º—É –æ–∫–Ω—É –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –æ–±—ä–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

### 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**:
```python
logger.debug(
    "Conversation history retrieved",
    user_id=str(user_id),
    turns=len(conversation) // 2,
    total_messages=len(conversation)
)
```

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 1. –†–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ LLM

- **–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å—Ç–æ—Ä–∏—è –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç —Ç–æ–∫–µ–Ω–æ–≤
- **–†–µ—à–µ–Ω–∏–µ**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ `max_conversation_turns` –∏ –æ–±—Ä–µ–∑–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤

### 2. –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ

- **–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è
- **–†–µ—à–µ–Ω–∏–µ**: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `RAG_CONVERSATION_WINDOW_HOURS`

### 3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–ü—Ä–æ–±–ª–µ–º–∞**: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ –ë–î –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- **–†–µ—à–µ–Ω–∏–µ**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤ Redis (–±—É–¥—É—â–µ–µ —É–ª—É—á—à–µ–Ω–∏–µ)

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
2. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ –ø—Ä–æ–º–ø—Ç—ã LangChain
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
4. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤ Redis
5. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
6. ‚è≥ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î (batch queries)

---

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
RAG Query
    ‚Üì
_get_conversation_history()
    ‚Üì
RAGQueryHistory (–ë–î)
    ‚Üì
–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ LangChain Messages
    ‚Üì
ChatPromptTemplate —Å MessagesPlaceholder
    ‚Üì
LLM (GigaChat) —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
    ‚Üì
–û—Ç–≤–µ—Ç —Å —É—á–µ—Ç–æ–º –∏—Å—Ç–æ—Ä–∏–∏
```

### –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** (–∏–∑ RAGQueryHistory):
```python
[
    {"role": "user", "content": "–ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ AI?"},
    {"role": "assistant", "content": "–í AI –µ—Å—Ç—å –º–Ω–æ–≥–æ –Ω–æ–≤–æ—Å—Ç–µ–π..."},
    {"role": "user", "content": "–ê —á—Ç–æ –ø—Ä–æ ML?"},
    {"role": "assistant", "content": "ML –∞–∫—Ç–∏–≤–Ω–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è..."}
]
```

**–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ LangChain Messages**:
```python
[
    HumanMessage(content="–ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ AI?"),
    AIMessage(content="–í AI –µ—Å—Ç—å –º–Ω–æ–≥–æ –Ω–æ–≤–æ—Å—Ç–µ–π..."),
    HumanMessage(content="–ê —á—Ç–æ –ø—Ä–æ ML?"),
    AIMessage(content="ML –∞–∫—Ç–∏–≤–Ω–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è...")
]
```

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `docker compose logs api | grep -i "conversation history"`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î: `SELECT * FROM rag_query_history WHERE user_id = '...' ORDER BY created_at DESC LIMIT 10;`
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–¥—Ä—è–¥ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

- `rag_conversation_history_used_total` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π –∏—Å—Ç–æ—Ä–∏–∏
- `rag_conversation_history_turns_avg` - —Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä –≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç
- `rag_conversation_history_size_bytes` - —Ä–∞–∑–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏ –≤ –±–∞–π—Ç–∞—Ö

