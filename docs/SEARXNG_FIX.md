# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SearXNG Integration

**–î–∞—Ç–∞**: 2025-02-02  
**–ü—Ä–æ–±–ª–µ–º–∞**: SearXNG –≤–æ–∑–≤—Ä–∞—â–∞–ª 403 Forbidden –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –∏–∑ API

## üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

### –û—à–∏–±–∫–∞
```
HTTP 403 Forbidden
ValidationException: Invalid value: "['general', 'news', 'wikipedia']"
```

### –ü—Ä–∏—á–∏–Ω–∞
SearXNG API –æ–∂–∏–¥–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `categories` –∫–∞–∫ —Å—Ç—Ä–æ–∫—É —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"general,news,wikipedia"`), –∞ –Ω–µ –∫–∞–∫ JSON-–º–∞—Å—Å–∏–≤.

–¢–∞–∫–∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `engines` —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π –¥–≤–∏–∂–∫–æ–≤ —á–µ—Ä–µ–∑ `!engine` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —á–µ—Ä–µ–∑ API –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### 1. –§–æ—Ä–º–∞—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π
**–ë—ã–ª–æ:**
```python
"categories": ",".join(search_categories)  # –ü—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞
```

**–°—Ç–∞–ª–æ:**
```python
categories_str = ",".join(search_categories) if isinstance(search_categories, list) else search_categories
"categories": categories_str,  # –Ø–≤–Ω–æ —Å—Ç—Ä–æ–∫–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
```

### 2. –£–±—Ä–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä engines
**–ë—ã–ª–æ:**
```python
"engines": ",".join([f"!{engine}" for engine in self.blocked_engines])
```

**–°—Ç–∞–ª–æ:**
```python
# –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–≤–∏–∂–∫–æ–≤ —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SearXNG (settings.yml), –Ω–µ —á–µ—Ä–µ–∑ API
# –ü–∞—Ä–∞–º–µ—Ç—Ä engines —É–±—Ä–∞–Ω –∏–∑ –∑–∞–ø—Ä–æ—Å–∞
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–¥
–§–∞–π–ª: `api/services/searxng_service.py`

- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç –ø–µ—Ä–µ–¥–∞—á–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- ‚úÖ –£–±—Ä–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `engines` –∏–∑ API –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ Context7 –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ health
```bash
curl http://localhost:8080/healthz
# –û—Ç–≤–µ—Ç: OK
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∏—Å–∫–∞
```bash
# –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å
curl "http://localhost:8080/search?q=Python&format=json&categories=general&language=ru"

# –ß–µ—Ä–µ–∑ SearXNG Service
docker compose exec api python3 -c "
from services.searxng_service import get_searxng_service
import asyncio
async def test():
    service = get_searxng_service()
    result = await service.search('Python', user_id='test', lang='ru')
    print(f'Results: {len(result.results)}')
asyncio.run(test())
"
```

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–≤–∏–∂–∫–æ–≤
–î–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã—Ö –¥–≤–∏–∂–∫–æ–≤ (torrent, adult –∏ —Ç.–¥.) —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ settings.yml** (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ):
   ```yaml
   engines:
     - name: duckduckgo
       enabled: true
     - name: google
       enabled: false  # –ë–ª–æ–∫–∏—Ä—É–µ–º
   ```

2. **–ß—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ–º–µ–Ω–æ–≤** (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ –¥–æ–º–µ–Ω–∞–º –≤ `_normalize_results()`
   - –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º

### Best Practices (Context7)
1. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç API –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
2. ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥–æ–º–µ–Ω–æ–≤ (–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ)
3. ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
4. ‚úÖ Rate limiting –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π

## ‚úÖ –ò—Ç–æ–≥

**–ü—Ä–æ–±–ª–µ–º–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞:**
- ‚úÖ –§–æ—Ä–º–∞—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- ‚úÖ SearXNG –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ SearXNG Service
- ‚úÖ Health check –ø—Ä–æ—Ö–æ–¥–∏—Ç

**SearXNG –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.**

