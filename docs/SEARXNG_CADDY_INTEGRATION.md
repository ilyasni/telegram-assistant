# SearXNG и Caddy Integration

**Дата**: 2025-02-02  
**Статус**: ✅ SearXNG и Caddy работают без конфликтов

## Анализ интеграции

### Порты
- **Caddy**: `80:80`, `443:443` (HTTP/HTTPS reverse proxy)
- **SearXNG**: `8080:8080` (поисковый движок)
- **Конфликт портов**: ❌ Отсутствует (разные порты)

### Взаимодействие

#### Caddy как Reverse Proxy
Caddy работает на портах 80/443 и может проксировать запросы к внутренним сервисам. SearXNG работает на порту 8080 и не конфликтует с Caddy.

#### Рекомендации (Context7)

1. **Разделение ответственности**:
   - ✅ Caddy: Reverse proxy для внешних запросов (80/443)
   - ✅ SearXNG: Внутренний поисковый сервис (8080)
   - ✅ API: Использует SearXNG напрямую через Docker network

2. **Опциональная интеграция**:
   Если нужно проксировать SearXNG через Caddy (например, для HTTPS), можно добавить в `Caddyfile`:
   ```caddy
   searxng.example.com {
       reverse_proxy searxng:8080
   }
   ```
   **Текущая конфигурация**: SearXNG используется только внутри Docker network, не требует проксирования через Caddy.

3. **Безопасность**:
   - ✅ SearXNG доступен только внутри Docker network
   - ✅ Порт 8080 не экспонирован наружу (опционально, можно убрать из ports)
   - ✅ Caddy обеспечивает HTTPS для публичных сервисов

## Health Check Results

### SearXNG Status
- ✅ **Container**: Up (healthy)
- ✅ **Health Endpoint**: `http://localhost:8080/healthz` → `OK`
- ✅ **Port**: 8080 (listening)
- ✅ **Bot Detection**: Отключен (limiter: false)

### Caddy Status
- ✅ **Container**: Up 12 days
- ✅ **Ports**: 80, 443 (listening)
- ✅ **Network**: telegram-network

### Integration Test
- ✅ SearXNG доступен из API контейнера
- ✅ Поиск работает корректно
- ✅ Нет конфликтов портов

## Best Practices (Context7)

1. ✅ **Разделение портов**: Caddy (80/443) и SearXNG (8080) не конфликтуют
2. ✅ **Внутреннее использование**: SearXNG используется только внутри Docker network
3. ✅ **Опциональное проксирование**: Можно добавить Caddy proxy для HTTPS, но не обязательно
4. ✅ **Безопасность**: SearXNG не экспонирован наружу (можно убрать ports mapping)

## Рекомендации

### Текущая конфигурация (рекомендуется)
- SearXNG доступен только внутри Docker network
- API использует SearXNG напрямую: `http://searxng:8080`
- Порты 8080 не обязательно экспонировать наружу

### Опциональная конфигурация
Если нужно публичное API SearXNG:
1. Настроить Caddy для проксирования SearXNG
2. Добавить HTTPS через Caddy
3. Оставить порт 8080 для внутреннего использования

## Итог

**Caddy и SearXNG работают без конфликтов:**
- ✅ Разные порты (80/443 vs 8080)
- ✅ SearXNG используется только внутри сети
- ✅ Caddy не влияет на работу SearXNG
- ✅ Нет необходимости в проксировании через Caddy

**Система готова к работе.**

