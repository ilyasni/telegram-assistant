# Проблема: IndexingTask не обрабатывает новые события

**Дата**: 2025-11-05  
**Context7**: Диагностика проблемы с обработкой событий posts.enriched

---

## Проблема

- **Consumer idle**: ~29 часов (104357264 ms)
- **Last delivered ID**: `1762250269353-0` (очень старый)
- **Последнее сообщение в stream**: `1762354553617-0` (намного новее)
- **Pending messages**: 0
- **Все посты в статусе `pending`**

---

## Наблюдения

1. **События posts.enriched с реальным tenant_id существуют**: 14 из 20 последних событий содержат реальный tenant_id
2. **IndexingTask инициализирован и запущен**: логи показывают "IndexingTask started"
3. **Consumer group существует**: `indexing_workers` с consumer `indexing_worker_1`
4. **Но consumer не обрабатывает новые сообщения**: idle уже 29 часов

---

## Возможные причины

1. **XREADGROUP блокируется или возвращает пустые результаты**
2. **Ошибки при обработке сообщений, которые не логируются**
3. **Проблема с event loop или asyncio**
4. **Consumer group настроен неправильно**

---

## Следующие шаги

1. Проверить, может ли XREADGROUP читать новые сообщения
2. Проверить логи на наличие ошибок при обработке
3. Проверить, вызывается ли `_process_single_message`
4. Проверить health check IndexingTask

