# –ü—Ä–æ–≤–µ—Ä–∫–∞ Scheduler –∏ –ø–∞–π–ø–ª–∞–π–Ω–∞ –ø–æ—Å—Ç–æ–≤ –∏ –∞–ª—å–±–æ–º–æ–≤

**–î–∞—Ç–∞**: 2025-01-22  
**Context7**: –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Scheduler –∏ –≤—Å–µ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ—Å—Ç–æ–≤ –∏ –∞–ª—å–±–æ–º–æ–≤

---

## 1. –°—Ç–∞—Ç—É—Å Scheduler

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
**–ü—Ä–æ–±–ª–µ–º–∞**: Scheduler –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª—Å—è –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ `AsyncIOScheduler.start()` —Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ event loop, –Ω–æ –≤—ã–∑—ã–≤–∞–ª—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ**: 
- –ò–∑–º–µ–Ω–µ–Ω `start_scheduler()` –Ω–∞ async —Ñ—É–Ω–∫—Ü–∏—é
- –í—ã–∑–æ–≤ —á–µ—Ä–µ–∑ `await start_scheduler()` –≤ lifespan startup
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

**–°—Ç–∞—Ç—É—Å**: Scheduler —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ API.

### –ó–∞–¥–∞—á–∏ Scheduler
- –î–∞–π–¥–∂–µ—Å—Ç—ã (–∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç)
- –¢—Ä–µ–Ω–¥—ã (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 00:00 UTC)
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ (–∫–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç)
- –†–∞—Å—á–µ—Ç storage usage (–∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤)

---

## 2. –ü–∞–π–ø–ª–∞–π–Ω –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ—Å—Ç–æ–≤

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞

```
1. telethon-ingest
   ‚Üì ChannelParser ‚Üí MediaProcessor ‚Üí AtomicDBSaver
   ‚Üì posts.parsed (Redis Stream)

2. post_persistence (PostPersistenceWorker)
   ‚Üì –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (posts, media_objects, media_groups)
   ‚Üì (–Ω–µ –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ, —Ç–æ–ª—å–∫–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç)

3. vision_analysis (VisionAnalysisTask)
   ‚Üì –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞ —á–µ—Ä–µ–∑ GigaChat Vision API
   ‚Üì posts.vision.analyzed (Redis Stream)

4. retagging (RetaggingTask)
   ‚Üì –†–µ-—Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É—á–µ—Ç–æ–º Vision —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   ‚Üì posts.tagged (trigger=vision_retag)

5. tagging (TaggingTask)
   ‚Üì –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ GigaChain
   ‚Üì posts.tagged (Redis Stream)

6. tag_persistence (TagPersistenceTask)
   ‚Üì –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–≥–æ–≤ –≤ –ë–î (post_enrichment, kind='tags')
   ‚Üì (–Ω–µ –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ, —Ç–æ–ª—å–∫–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç)

7. crawl_trigger (CrawlTriggerTask)
   ‚Üì –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –¥–ª—è Crawl4AI
   ‚Üì posts.crawl (Redis Stream)

8. enrichment (EnrichmentTask)
   ‚Üì –û–±–æ–≥–∞—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Crawl4AI
   ‚Üì posts.enriched (Redis Stream)

9. indexing (IndexingTask)
   ‚Üì –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤ Qdrant + Neo4j
   ‚Üì posts.indexed (Redis Stream)
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–∞–π–ø–ª–∞–π–Ω–∞

#### ‚úÖ telethon-ingest
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **–ó–∞–¥–∞—á–∏**: –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞–Ω–∞–ª–æ–≤, –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –∏ –º–µ–¥–∏–∞
- **–°–æ–±—ã—Ç–∏—è**: `posts.parsed`, `albums.parsed`

#### ‚úÖ post_persistence
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–ø—É—â–µ–Ω (—á–µ—Ä–µ–∑ supervisor)
- **–ó–∞–¥–∞—á–∏**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –≤ –ë–î
- **–°–æ–±—ã—Ç–∏—è**: –ù–µ –ø—É–±–ª–∏–∫—É–µ—Ç (—Ç–æ–ª—å–∫–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç)

#### ‚úÖ vision_analysis
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–ø—É—â–µ–Ω (—á–µ—Ä–µ–∑ supervisor)
- **–ó–∞–¥–∞—á–∏**: Vision –∞–Ω–∞–ª–∏–∑ –º–µ–¥–∏–∞ —á–µ—Ä–µ–∑ GigaChat Vision API
- **–°–æ–±—ã—Ç–∏—è**: `posts.vision.analyzed`
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ SHA256, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å S3, Budget Gate, Policy Engine

#### ‚úÖ retagging
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–ø—É—â–µ–Ω (—á–µ—Ä–µ–∑ supervisor)
- **–ó–∞–¥–∞—á–∏**: –†–µ-—Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É—á–µ—Ç–æ–º Vision —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **–°–æ–±—ã—Ç–∏—è**: `posts.tagged` (trigger=vision_retag)

#### ‚úÖ tagging
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–ø—É—â–µ–Ω (—á–µ—Ä–µ–∑ supervisor)
- **–ó–∞–¥–∞—á–∏**: –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ GigaChain
- **–°–æ–±—ã—Ç–∏—è**: `posts.tagged`

#### ‚úÖ tag_persistence
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–ø—É—â–µ–Ω (—á–µ—Ä–µ–∑ supervisor)
- **–ó–∞–¥–∞—á–∏**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–≥–æ–≤ –≤ –ë–î
- **–°–æ–±—ã—Ç–∏—è**: –ù–µ –ø—É–±–ª–∏–∫—É–µ—Ç (—Ç–æ–ª—å–∫–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç)

#### ‚úÖ crawl_trigger
- **–°—Ç–∞—Ç—É—Å**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ - —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- **–ó–∞–¥–∞—á–∏**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –¥–ª—è Crawl4AI
- **–°–æ–±—ã—Ç–∏—è**: `posts.crawl`
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ `start()` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∏–∑ Redis Stream
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ `asyncio.CancelledError` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

#### ‚úÖ enrichment
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–ø—É—â–µ–Ω (—á–µ—Ä–µ–∑ supervisor)
- **–ó–∞–¥–∞—á–∏**: –û–±–æ–≥–∞—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Crawl4AI
- **–°–æ–±—ã—Ç–∏—è**: `posts.enriched`

#### ‚úÖ indexing
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–ø—É—â–µ–Ω (—á–µ—Ä–µ–∑ supervisor)
- **–ó–∞–¥–∞—á–∏**: –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤ Qdrant + Neo4j
- **–°–æ–±—ã—Ç–∏—è**: `posts.indexed`

---

## 3. –ü–∞–π–ø–ª–∞–π–Ω –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞–ª—å–±–æ–º–æ–≤

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞

```
1. telethon-ingest
   ‚Üì ChannelParser ‚Üí MediaGroupSaver
   ‚Üì albums.parsed (Redis Stream)

2. vision_analysis (VisionAnalysisTask)
   ‚Üì –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞ –∏–∑ –∞–ª—å–±–æ–º–∞ —á–µ—Ä–µ–∑ GigaChat Vision API
   ‚Üì posts.vision.analyzed (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –∞–ª—å–±–æ–º–∞)

3. album_assembler (AlbumAssemblerTask)
   ‚Üì –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ vision –∞–Ω–∞–ª–∏–∑–∞ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∞–ª—å–±–æ–º–∞
   ‚Üì –°–±–æ—Ä–∫–∞ vision summary –Ω–∞ —É—Ä–æ–≤–Ω–µ –∞–ª—å–±–æ–º–∞
   ‚Üì album.assembled (Redis Stream)
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–∞–π–ø–ª–∞–π–Ω–∞

#### ‚úÖ telethon-ingest (–∞–ª—å–±–æ–º—ã)
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **–ó–∞–¥–∞—á–∏**: –ü–∞—Ä—Å–∏–Ω–≥ –∞–ª—å–±–æ–º–æ–≤, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ media_groups
- **–°–æ–±—ã—Ç–∏—è**: `albums.parsed`

#### ‚úÖ vision_analysis (–∞–ª—å–±–æ–º—ã)
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–ø—É—â–µ–Ω (—á–µ—Ä–µ–∑ supervisor)
- **–ó–∞–¥–∞—á–∏**: Vision –∞–Ω–∞–ª–∏–∑ –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –∞–ª—å–±–æ–º–∞
- **–°–æ–±—ã—Ç–∏—è**: `posts.vision.analyzed` (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞)

#### ‚úÖ album_assembler
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–ø—É—â–µ–Ω (—á–µ—Ä–µ–∑ supervisor)
- **–ó–∞–¥–∞—á–∏**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ vision –∞–Ω–∞–ª–∏–∑–∞, —Å–±–æ—Ä–∫–∞ –∞–ª—å–±–æ–º–∞
- **–°–æ–±—ã—Ç–∏—è**: `album.assembled`
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: –•—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–ª—å–±–æ–º–æ–≤ –≤ Redis, –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç vision summary

---

## 4. –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. **Scheduler –Ω–µ –∑–∞–ø—É—â–µ–Ω** ‚úÖ
   - **–ü—Ä–æ–±–ª–µ–º–∞**: `AsyncIOScheduler.start()` —Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ event loop
   - **–†–µ—à–µ–Ω–∏–µ**: –ò–∑–º–µ–Ω–µ–Ω `start_scheduler()` –Ω–∞ async —Ñ—É–Ω–∫—Ü–∏—é, –≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ `await` –≤ lifespan
   - **–°—Ç–∞—Ç—É—Å**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

2. **crawl_trigger –∑–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ** ‚úÖ
   - **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –ø—Ä–∏–≤–æ–¥–∏–ª–∞ –∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –∑–∞–¥–∞—á–∏
   - **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ `start()` —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º —Ä–∞–±–æ—Ç—ã
   - **–°—Ç–∞—Ç—É—Å**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ

1. **asyncpg –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ API –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ**
   - **–ü—Ä–æ–±–ª–µ–º–∞**: `calculate_tenant_storage_usage_task` –Ω–µ –º–æ–∂–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `asyncpg`
   - **–í–ª–∏—è–Ω–∏–µ**: –†–∞—Å—á–µ—Ç storage usage –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
   - **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å `asyncpg` –≤ `api/requirements.txt` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sync –≤–µ—Ä—Å–∏—é StorageQuotaService

---

## 5. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω Scheduler** ‚úÖ
   - –ò–∑–º–µ–Ω–µ–Ω `start_scheduler()` –Ω–∞ async —Ñ—É–Ω–∫—Ü–∏—é
   - –í—ã–∑–æ–≤ —á–µ—Ä–µ–∑ `await start_scheduler()` –≤ lifespan startup
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω crawl_trigger** ‚úÖ
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ `start()`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∏–∑ Redis Stream
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ `asyncio.CancelledError`

3. **–î–æ–±–∞–≤–∏—Ç—å asyncpg –≤ API** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - –î–æ–±–∞–≤–∏—Ç—å `asyncpg` –≤ `api/requirements.txt`
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sync –≤–µ—Ä—Å–∏—é StorageQuotaService –¥–ª—è `calculate_tenant_storage_usage_task`

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–π–ø–ª–∞–π–Ω–∞**
   - –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —ç—Ç–∞–ø–æ–≤
   - –î–æ–±–∞–≤–∏—Ç—å dashboard –≤ Grafana

2. **–£–ª—É—á—à–µ–Ω–∏–µ observability**
   - –î–æ–±–∞–≤–∏—Ç—å trace_id –¥–ª—è –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π
   - –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
   - –î–æ–±–∞–≤–∏—Ç—å health checks –¥–ª—è –≤—Å–µ—Ö –∑–∞–¥–∞—á

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–∞**
   - –î–æ–±–∞–≤–∏—Ç—å E2E —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞
   - –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
   - –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã

---

## 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Scheduler
docker compose exec api python -c "from tasks.scheduler_tasks import scheduler; print('Running:', scheduler.running if scheduler else 'None')"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ worker –∑–∞–¥–∞—á
docker compose logs worker --tail 100 | grep -E "(started|running|error|failed)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis Streams
docker compose exec redis redis-cli XINFO STREAM stream:posts:parsed
docker compose exec redis redis-cli XINFO GROUPS stream:posts:parsed

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose ps | grep -E "(api|worker|telethon)"
```

---

## 7. –ò—Ç–æ–≥

### ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- telethon-ingest (–ø–∞—Ä—Å–∏–Ω–≥ –ø–æ—Å—Ç–æ–≤ –∏ –∞–ª—å–±–æ–º–æ–≤)
- post_persistence (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î)
- vision_analysis (Vision –∞–Ω–∞–ª–∏–∑)
- retagging (—Ä–µ-—Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- tagging (—Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- tag_persistence (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–≥–æ–≤)
- enrichment (–æ–±–æ–≥–∞—â–µ–Ω–∏–µ)
- indexing (–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è)
- album_assembler (—Å–±–æ—Ä–∫–∞ –∞–ª—å–±–æ–º–æ–≤)

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- Scheduler –Ω–µ –∑–∞–ø—É—â–µ–Ω ‚Üí ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (async —Ñ—É–Ω–∫—Ü–∏—è)
- crawl_trigger –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ ‚Üí ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π)

### ‚ö†Ô∏è –û—Å—Ç–∞–ª–æ—Å—å
- asyncpg –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ API (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sync –≤–µ—Ä—Å–∏—é)

### üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å Scheduler - –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å crawl_trigger - –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
3. –î–æ–±–∞–≤–∏—Ç—å asyncpg –≤ API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. –£–ª—É—á—à–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ observability

