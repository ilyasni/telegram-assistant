# –û—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–¥–∞—á–∏

**–î–∞—Ç–∞**: 2025-11-17 17:30  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, –æ—Å—Ç–∞–ª–∏—Å—å —É–ª—É—á—à–µ–Ω–∏—è

## ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

1. **Vision –ø–∞–π–ø–ª–∞–π–Ω** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
2. **Enrichment feature flags** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–ª—å–±–æ–º–æ–≤** - —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
4. **Tagging forward_peer_id** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
5. **MediaProcessor –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç time_utils
6. **CrawlTriggerTask** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

## üìã –û–°–¢–ê–í–®–ò–ï–°–Ø –ó–ê–î–ê–ß–ò

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

1. **Group messages ON CONFLICT error**
   - **–ü—Ä–æ–±–ª–µ–º–∞**: `there is no unique or exclusion constraint matching the ON CONFLICT specification` –¥–ª—è group messages
   - **–§–∞–π–ª**: `telethon-ingest/services/telegram_client.py`
   - **–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è channel parsing, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
   - **–î–µ–π—Å—Ç–≤–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ö–µ–º—É –ë–î –¥–ª—è group messages –∏ –¥–æ–±–∞–≤–∏—Ç—å UNIQUE constraint

### –°—Ä–µ–¥–Ω–∏–µ –∑–∞–¥–∞—á–∏

1. **–£–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ Vision –¥–ª—è –∞–ª—å–±–æ–º–æ–≤**
   - **–ü—Ä–æ–±–ª–µ–º–∞**: Vision —Å–æ–±—ã—Ç–∏—è —ç–º–∏—Ç—è—Ç—Å—è –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤, –Ω–æ –Ω–µ –¥–ª—è –∞–ª—å–±–æ–º–æ–≤ —Ü–µ–ª–∏–∫–æ–º
   - **–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - –∞–ª—å–±–æ–º—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ—Å—Ç—ã
   - **–î–µ–π—Å—Ç–≤–∏–µ**: –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —ç–º–∏—Å—Å–∏—é Vision —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∞–ª—å–±–æ–º–æ–≤

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Enrichment —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤**
   - **–ü—Ä–æ–±–ª–µ–º–∞**: –ú–Ω–æ–≥–∏–µ –ø–æ—Å—Ç—ã –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
   - **–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å
   - **–î–µ–π—Å—Ç–≤–∏–µ**: –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –∏–ª–∏ —Å–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–æ–≤

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Vision –∞–Ω–∞–ª–∏–∑–∞**
   - **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ Vision —Å–æ–±—ã—Ç–∏–π
   - **–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
   - **–î–µ–π—Å—Ç–≤–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è VisionAnalysisTask

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—É–ª—É—á—à–µ–Ω–∏—è)

1. **–ò–Ω–¥–µ–∫—Å –¥–ª—è post_enrichment.kind**
   - **–§–∞–π–ª**: –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic
   - **–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
   - **–î–µ–π—Å—Ç–≤–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

2. **–ú–∏–≥—Ä–∞—Ü–∏—è legacy –ø–æ–ª–µ–π**
   - **–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
   - **–î–µ–π—Å—Ç–≤–∏–µ**: –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è –∏–∑ —Å—Ö–µ–º—ã –ë–î

3. **–£–ª—É—á—à–µ–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ Vision –æ—Ç–≤–µ—Ç–æ–≤**
   - **–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
   - **–î–µ–π—Å—Ç–≤–∏–µ**: –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—Ç–≤–µ—Ç–æ–≤ GigaChat Vision API

## üìä –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–° –ü–ê–ô–ü–õ–ê–ô–ù–ê

### –†–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞–Ω–∞–ª–æ–≤ (incremental mode)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞ —á–µ—Ä–µ–∑ MediaProcessor
- –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–æ–≤
- –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤ Qdrant –∏ Neo4j
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–ª—å–±–æ–º–æ–≤

### –¢—Ä–µ–±—É–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ ‚ö†Ô∏è
- Vision –ø–∞–π–ø–ª–∞–π–Ω (—Å–æ–±—ã—Ç–∏—è —ç–º–∏—Ç—è—Ç—Å—è, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É)
- Enrichment (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤)
- Crawl4AI (–Ω–∏–∑–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)

## üîç –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ Vision, Enrichment –∏ –∞–ª—å–±–æ–º–æ–≤
2. **–ú–µ—Ç—Ä–∏–∫–∏**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ Prometheus –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞–¥–∏–π –ø–∞–π–ø–ª–∞–π–Ω–∞
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø–∞–π–ø–ª–∞–π–Ω–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üìù –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏ Vision –Ω–∞ –Ω–∞–ª–∏—á–∏–µ "No vision-suitable media files"
2. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏ Enrichment –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏ –∞–ª—å–±–æ–º–æ–≤ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ "Post in album has no media"
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ Prometheus –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞–¥–∏–π –ø–∞–π–ø–ª–∞–π–Ω–∞
