# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–æ–≤ —Ç—Ä–µ–Ω–¥–æ–≤

**–î–∞—Ç–∞**: 2025-11-16  
**Context7**: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º—É –∑–∞–ø—É—Å–∫—É –∞–≥–µ–Ω—Ç–æ–≤

## ‚úÖ –ß—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 1. Trend Editor Agent

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ì–¥–µ**: `api/worker/run_all_tasks.py`

- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ `TaskSupervisor` –∫–∞–∫ –∑–∞–¥–∞—á–∞ `trend_editor`
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ worker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ Redis Stream `trends.emerging`
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```bash
docker compose logs worker | grep -i "trend_editor"
```

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
- –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ: `TREND_EDITOR_ENABLED=true/false` –≤ `.env`
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å worker:
  ```bash
  docker compose restart worker
  ```

### 2. Trend QA/Filter Agent

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ì–¥–µ**: `api/routers/trends.py`

- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ API endpoints:
  - `GET /api/trends/emerging`
  - `GET /api/trends/clusters`
  - `GET /api/trends/clusters/{id}`
- –†–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ API
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
- –ú–µ—Ç—Ä–∏–∫–∏ Prometheus: `trend_qa_filtered_total`
- –õ–æ–≥–∏ API –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ `/api/trends/*`

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
- –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ: `TREND_QA_ENABLED=true/false` –≤ `.env`
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å API:
  ```bash
  docker compose restart api
  ```

### 3. User Interest Personalizer Agent

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

**–ì–¥–µ**: `api/tasks/scheduler_tasks.py`

- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ `AsyncIOScheduler`
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ **02:00 UTC**
- –û–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```bash
docker compose logs api | grep -i "update_user_trend_profiles"
```

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
- –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ: `TREND_PERSONALIZER_ENABLED=true/false` –≤ `.env`
- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ `scheduler_tasks.py` (—Å—Ç—Ä–æ–∫–∞ 1221)

### 4. Threshold Tuner Agent

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

**–ì–¥–µ**: `api/tasks/scheduler_tasks.py`

- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ `AsyncIOScheduler`
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ –≤ **–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 03:00 UTC**
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ—Ä–æ–≥–æ–≤ –∏ —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```bash
docker compose logs api | grep -i "analyze_trend_thresholds"
```

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
- –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ: `TREND_THRESHOLD_TUNER_ENABLED=true/false` –≤ `.env`
- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ `scheduler_tasks.py` (—Å—Ç—Ä–æ–∫–∞ 1229)

### 5. Taxonomy Agent

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è

**–ì–¥–µ**: `api/worker/trends_editor_agent.py`

- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ Trend Editor Agent
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
- –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ: `TREND_TAXONOMY_ENABLED=true/false` –≤ `.env`
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å worker:
  ```bash
  docker compose restart worker
  ```

---

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å

### 1. Environment Variables

**‚úÖ –£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ `docker-compose.yml`!**

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏–∑ `.env` —Ñ–∞–π–ª–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –¥–æ–±–∞–≤—å—Ç–µ –≤ `.env` —Ñ–∞–π–ª:

```bash
# Trend Editor Agent
TREND_EDITOR_ENABLED=true
TREND_EDITOR_MIN_SCORE=0.6
TREND_EDITOR_LLM_MODEL=GigaChat

# Trend QA/Filter Agent
TREND_QA_ENABLED=true
TREND_QA_MIN_SCORE=0.6
TREND_QA_LLM_MODEL=GigaChat

# –î—Ä—É–≥–∏–µ –∞–≥–µ–Ω—Ç—ã
TREND_PERSONALIZER_ENABLED=true
TREND_TAXONOMY_ENABLED=true
TREND_THRESHOLD_TUNER_ENABLED=true
```

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å worker (–¥–ª—è Editor –∏ Taxonomy –∞–≥–µ–Ω—Ç–æ–≤)
docker compose restart worker

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å API (–¥–ª—è QA –∞–≥–µ–Ω—Ç–∞ –∏ scheduled tasks)
docker compose restart api
```

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Trend Editor Agent

```bash
# –õ–æ–≥–∏ worker
docker compose logs worker | grep -i "trend_editor"

# –ú–µ—Ç—Ä–∏–∫–∏ Prometheus
curl http://localhost:9090/api/v1/query?query=trend_editor_requests_total
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ QA Agent

```bash
# –ú–µ—Ç—Ä–∏–∫–∏ Prometheus
curl http://localhost:9090/api/v1/query?query=trend_qa_filtered_total

# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ API
curl http://localhost:8000/api/trends/emerging
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Scheduled Tasks

```bash
# –õ–æ–≥–∏ API —Å scheduler
docker compose logs api | grep -i "scheduler\|update_user_trend_profiles\|analyze_trend_thresholds"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
./scripts/check_trend_agents.sh
```

---

## üöÄ –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

–ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ —Ç–æ–ª—å–∫–æ —á—Ç–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞:

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î**:
   ```bash
   ./scripts/apply_trend_agents_migration.sh
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é**:
   ```bash
   # –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
   grep TREND_ .env
   ```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã**:
   ```bash
   docker compose restart worker api
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É**:
   ```bash
   ./scripts/check_trend_agents.sh
   ```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### Trend Editor Agent

- **–¢—Ä–µ–±—É–µ—Ç**: Redis Stream `trends.emerging` –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å
- **–¢—Ä–µ–±—É–µ—Ç**: –°–æ–±—ã—Ç–∏—è –¥–æ–ª–∂–Ω—ã –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å—Å—è –≤ `trends.emerging`
- **–ï—Å–ª–∏ –Ω–µ—Ç —Å–æ–±—ã—Ç–∏–π**: –ê–≥–µ–Ω—Ç –±—É–¥–µ—Ç –∂–¥–∞—Ç—å, –Ω–æ –Ω–µ –±—É–¥–µ—Ç –æ—à–∏–±–æ–∫

### QA Agent

- **–†–∞–±–æ—Ç–∞–µ—Ç**: –¢–æ–ª—å–∫–æ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ API
- **–ï—Å–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω**: –¢—Ä–µ–Ω–¥—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- **Fail-open**: –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö LLM —Ç—Ä–µ–Ω–¥—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ–∂–∏–º)

### Scheduled Tasks

- **–¢—Ä–µ–±—É—é—Ç**: –ó–∞–ø—É—â–µ–Ω–Ω—ã–π API –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- **Scheduler**: –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ `lifespan` —Ñ—É–Ω–∫—Ü–∏–∏ API
- **–ï—Å–ª–∏ API –Ω–µ –∑–∞–ø—É—â–µ–Ω**: –ó–∞–¥–∞—á–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è

---

## üìù –ò—Ç–æ–≥

**–í—Å–µ –∞–≥–µ–Ω—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏:

1. ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã `worker` –∏ `api` –∑–∞–ø—É—â–µ–Ω—ã
2. ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ `.env`
3. ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
4. ‚úÖ Redis –¥–æ—Å—Ç—É–ø–µ–Ω (–¥–ª—è Editor Agent)
5. ‚úÖ LLM –¥–æ—Å—Ç—É–ø–µ–Ω (GigaChat —á–µ—Ä–µ–∑ gpt2giga-proxy)

**–ù–∏—á–µ–≥–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ!** üéâ

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- **Editor Agent** ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **QA Agent** ‚Äî —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Ç—Ä–µ–Ω–¥—ã –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- **Personalizer Agent** ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–æ—Ñ–∏–ª–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ
- **Threshold Tuner Agent** ‚Äî –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Ä–æ–≥–∏ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ
- **Taxonomy Agent** ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ Editor Agent

