# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GigaChat API

## Context
GigaChat Proxy —Å fallback –º–µ—Ö–∞–Ω–∏–∑–º–æ–º —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ credentials.

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
‚úÖ **GigaChat Proxy –∑–∞–ø—É—â–µ–Ω**: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 8090  
‚úÖ **Fallback –º–µ—Ö–∞–Ω–∏–∑–º**: OpenRouter fallback –Ω–∞—Å—Ç—Ä–æ–µ–Ω  
‚úÖ **–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã**: –ö–æ—Ä–Ω–µ–≤—ã–µ –∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –ú–∏–Ω—Ü–∏—Ñ—Ä—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã  
‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã  
‚ö†Ô∏è **Credentials**: –¢—Ä–µ–±—É—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ credentials –¥–ª—è GigaChat API  

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö credentials

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ credentials

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [GigaChat –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤](https://developers.sber.ru/gigachat)
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
4. –ü–æ–ª—É—á–∏—Ç–µ credentials –≤ —Ñ–æ—Ä–º–∞—Ç–µ: `client_id:client_secret`

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ .env —Ñ–∞–π–ª–∞

```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ credentials
GIGACHAT_CREDENTIALS=your_real_client_id:your_real_client_secret

# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ scope –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
GIGACHAT_SCOPE=GIGACHAT_API_PERS

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–¥–µ–ª—å
GIGACHAT_MODEL=GigaChat
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

```bash
cd /opt/telegram-assistant
docker compose restart gpt2giga-proxy
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –¢–µ—Å—Ç health check
curl http://localhost:8090/health

# –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
curl -X POST "http://localhost:8090/v1/chat/completions" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer dummy" \
  -d '{
    "model": "gpt-3.5-turbo",
    "messages": [{"role": "user", "content": "–ü—Ä–∏–≤–µ—Ç!"}],
    "max_tokens": 100
  }'
```

## Fallback –º–µ—Ö–∞–Ω–∏–∑–º

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
1. **GigaChat** (–æ—Å–Ω–æ–≤–Ω–æ–π) - —Ä–æ—Å—Å–∏–π—Å–∫–∞—è –º–æ–¥–µ–ª—å
2. **OpenRouter** (fallback) - –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –º–æ–¥–µ–ª–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
- –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ GigaChat –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è OpenRouter
- –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ–±–æ–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞
- Health check –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ GigaChat Proxy
docker compose logs gpt2giga-proxy -f

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker compose ps gpt2giga-proxy
```

### Health Check
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
curl http://localhost:8090/health | jq .
```

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: 401 Unauthorized
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ credentials  
**–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç–µ `GIGACHAT_CREDENTIALS` –≤ .env —Ñ–∞–π–ª–µ

### –ü—Ä–æ–±–ª–µ–º–∞: 403 Forbidden  
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π scope –∏–ª–∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞  
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `GIGACHAT_SCOPE=GIGACHAT_API_PERS`

### –ü—Ä–æ–±–ª–µ–º–∞: Fallback –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
**–ü—Ä–∏—á–∏–Ω–∞**: OpenRouter API key –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω  
**–†–µ—à–µ–Ω–∏–µ**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `OPENROUTER_API_KEY` –≤ .env —Ñ–∞–π–ª–µ

## Best Practices

### Context7 Integration
- ‚úÖ Structured logging —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
- ‚úÖ Health checks –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤  
- ‚úÖ Fallback –º–µ—Ö–∞–Ω–∏–∑–º —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

### Supabase Integration
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ PostgreSQL —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –ú—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ tenant_id

### Security
- ‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –ú–∏–Ω—Ü–∏—Ñ—Ä—ã –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ credentials –≤ .env
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–µ Docker –æ–±—Ä–∞–∑—ã –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ credentials** –¥–ª—è GigaChat API
2. **–û–±–Ω–æ–≤–∏—Ç—å .env —Ñ–∞–π–ª** —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é** —Å worker —Å–µ—Ä–≤–∏—Å–æ–º
4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** —á–µ—Ä–µ–∑ Grafana
5. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏** –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ —Å GigaChat! –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö credentials. Fallback –º–µ—Ö–∞–Ω–∏–∑–º –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –¥–∞–∂–µ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.

üöÄ **–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!**
