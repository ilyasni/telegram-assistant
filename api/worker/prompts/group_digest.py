"""
–ü—Ä–æ–º–ø—Ç—ã –¥–ª—è –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ –≥—Ä—É–ø–ø–æ–≤—ã—Ö –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤.

Context7:
- –í—Å–µ –ø—Ä–æ–º–ø—Ç—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º.
- –ö–∞–∂–¥—ã–π –ø—Ä–æ–º–ø—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç—Ä–æ–≥–∏–µ guardrails –∏ JSON –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã.
"""

from __future__ import annotations

from textwrap import dedent

from langchain_core.prompts import ChatPromptTemplate


def thread_builder_prompt_v1() -> ChatPromptTemplate:
    """–ü—Ä–æ–º–ø—Ç –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –¥–∏—Å–∫—É—Å—Å–∏–æ–Ω–Ω—ã—Ö –≤–µ—Ç–æ–∫."""
    system = dedent(
        """\
        –¢—ã –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å —Å–æ–æ–±—â–µ–Ω–∏—è Telegram-–≥—Ä—É–ø–ø—ã –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—à—å –¥–∏—Å–∫—É—Å—Å–∏–æ–Ω–Ω—ã–µ –≤–µ—Ç–∫–∏.
        –ü—Ä–∞–≤–∏–ª–∞:
        - –†–∞–±–æ—Ç–∞–π —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.
        - –£—á–∏—Ç—ã–≤–∞–π reply_to, –≤—Ä–µ–º–µ–Ω–Ω—É—é –±–ª–∏–∑–æ—Å—Ç—å –∏ –ø–æ—Ö–æ–∂–µ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞.
        - –ù–µ –ø—Ä–µ–≤—ã—à–∞–π 20 —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –≤–µ—Ç–∫—É; –µ—Å–ª–∏ –±–æ–ª—å—à–µ ‚Äî —Ä–∞–∑–±–µ–π –Ω–∞ —á–∞—Å—Ç–∏ –∏ –¥–æ–±–∞–≤—å —Å—É—Ñ—Ñ–∏–∫—Å '-partN'.
        - –í–æ–∑–≤—Ä–∞—â–∞–π —Ç–æ–ª—å–∫–æ JSON –ø–æ —Å—Ö–µ–º–µ –Ω–∏–∂–µ. –ù–∏–∫–∞–∫–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏–ª–∏ Markdown.
        - –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, –≤–µ—Ä–Ω–∏ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ threads.
        - –ü–æ–ª–µ similarity_reason –æ–ø–∏—à–∏ —Å–ª–æ–≤–∞–º–∏, –ø–æ—á–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã (<=120 —Å–∏–º–≤–æ–ª–æ–≤).
        - –ü—Ä–∏ —Å–æ–º–Ω–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ msg_ids.
        """
    )
    human = dedent(
        """\
        –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
        - messages_json: —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø–æ–ª—è–º–∏ message_id, timestamp_iso, username, content, reply_to_id.
        - max_thread_len: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –≤–µ—Ç–∫–∏.

        –í–µ—Ä–Ω–∏ JSON —Å—Ç—Ä–æ–≥–æ –ø–æ —Å—Ö–µ–º–µ:
        {{
          "threads": [
            {{
              "thread_id": "thread-001",
              "msg_ids": ["123", "124"],
              "start_ts": "2025-11-10T08:15:01+00:00",
              "end_ts": "2025-11-10T08:24:59+00:00",
              "reply_root": "122",
              "similarity_reason": "–û–±—Å—É–∂–¥–µ–Ω–∏–µ –±–∞–≥–∞ –≤–µ–±–≤—å—é"
            }}
          ]
        }}

        messages_json:
        {messages_json}
        max_thread_len: {max_thread_len}
        """
    )
    return ChatPromptTemplate.from_messages([("system", system), ("human", human)])


def semantic_segmenter_prompt_v1() -> ChatPromptTemplate:
    """–ü—Ä–æ–º–ø—Ç –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–µ—Ç–æ–∫."""
    system = dedent(
        """\
        –¢—ã –≤—ã–¥–µ–ª—è–µ—à—å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏ –≤–Ω—É—Ç—Ä–∏ –≤–µ—Ç–∫–∏ –æ–±—Å—É–∂–¥–µ–Ω–∏—è.
        –î–æ–ø—É—Å—Ç–∏–º—ã–µ —Ç–∏–ø—ã –±–ª–æ–∫–æ–≤: problem, solution, decision, risk, celebration, meta, humor.
        –û—Ç–≤–µ—Ç —Ç–æ–ª—å–∫–æ JSON –ø–æ —Å—Ö–µ–º–µ. –£–∫–∞–∑—ã–≤–∞–π confidence –æ—Ç 0 –¥–æ 1.
        –ò–≥–Ω–æ—Ä–∏—Ä—É–π —Å—Ç–∏–∫–µ—Ä—ã, —ç–º–æ–¥–∑–∏, –ø—É—Å—Ç—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è. –ï—Å–ª–∏ –±–ª–æ–∫ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω ‚Äî kind='meta'.
        
        –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
        - –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π ‚â• 30, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–¥–µ–ª–∏ –Ω–µ –º–µ–Ω–µ–µ 2-3 —Ç–µ–º/–±–ª–æ–∫–æ–≤
        - –ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è –ø–∏—Å–∞—Ç—å, —á—Ç–æ —Ç–µ–º—ã –Ω–µ –≤—ã—è–≤–ª–µ–Ω—ã. –ï—Å–ª–∏ —Å–ª–æ–∂–Ω–æ ‚Äî –æ–ø–∏—Ä–∞–π—Å—è –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏ —Å–≤—è–∑–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤
        - –ï—Å–ª–∏ –≤—Å—ë –∫–∞–∂–µ—Ç—Å—è –æ–¥–Ω–æ–π —Ç–µ–º–æ–π ‚Äî —Ä–∞–∑–±–µ–π –ø–æ –ø–æ–¥–ø–æ–¥—Ö–æ–¥–∞–º/–ø–æ–¥-–≤–æ–ø—Ä–æ—Å–∞–º
        - –ò—Å–ø–æ–ª—å–∑—É–π reply_to —Å–≤—è–∑–∏ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        """
    )
    human = dedent(
        """\
        –î–∞–Ω–Ω—ã–µ –≤–µ—Ç–∫–∏:
        thread_id: {thread_id}
        messages:
        {thread_messages}

        –í–µ—Ä–Ω–∏ JSON –≤–∏–¥–∞:
        {{
          "thread_id": "t1",
          "units": [
            {{
              "kind": "problem",
              "text": "...",
              "msg_ids": ["id1", "id2"],
              "offset_range": [0, 120],
              "confidence": 0.84
            }}
          ]
        }}

        –ï—Å–ª–∏ –Ω–µ—Ç —Å–º—ã—Å–ª–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤ ‚Äî –≤–µ—Ä–Ω–∏ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ units.
        """
    )
    return ChatPromptTemplate.from_messages([("system", system), ("human", human)])


def semantic_segmenter_repair_prompt_v1() -> ChatPromptTemplate:
    """–ü—Ä–æ–º–ø—Ç –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è JSON —Å–µ–≥–º–µ–Ω—Ç–µ—Ä–∞."""
    system = (
        "–¢—ã –∏—Å–ø—Ä–∞–≤–ª—è–µ—à—å JSON-–æ—Ç–≤–µ—Ç –∞–≥–µ–Ω—Ç–∞ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.\n"
        "–ù—É–∂–Ω–æ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –æ—à–∏–±–∫–∏, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ —Å–ø–∏—Å–∫–µ, –∏ –≤–µ—Ä–Ω—É—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON."
    )
    human = (
        "–ö–æ–Ω—Ç–µ–∫—Å—Ç –≤–µ—Ç–∫–∏:\n"
        "{thread_messages}\n\n"
        "–ü—Ä–µ–¥—ã–¥—É—â–∏–π –æ—Ç–≤–µ—Ç:\n"
        "{invalid_json}\n\n"
        "–û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:\n"
        "{errors}\n\n"
        "–í–µ—Ä–Ω–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π JSON –ø–æ —Å—Ö–µ–º–µ segmenter_agent.\n"
        "–ù–µ –¥–æ–±–∞–≤–ª—è–π —Ç–µ–∫—Å—Ç –≤–Ω–µ JSON."
    )
    return ChatPromptTemplate.from_messages([("system", system), ("human", human)])


def emotion_analyzer_prompt_v1() -> ChatPromptTemplate:
    """–ü—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —ç–º–æ—Ü–∏–π."""
    system = dedent(
        """\
        –¢—ã —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫. –û—Ü–µ–Ω–∏ –æ–±—â–∏–π —Ç–æ–Ω —Ä–∞–∑–≥–æ–≤–æ—Ä–∞, –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω–æ—Å—Ç—å –∏ –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏—é.
        –í–µ—Ä–Ω–∏ JSON –ø–æ —Å—Ö–µ–º–µ. –ó–Ω–∞—á–µ–Ω–∏—è intensity, conflict, collaboration, stress, enthusiasm –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [0,1].
        –ü–æ–ª–µ tone ‚àà {{positive, neutral, negative}}. –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö ‚Äî tone='neutral'.
        
        –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
        - –°—Ñ–æ–∫—É—Å–∏—Ä—É–π—Å—è –Ω–∞ –º–µ—Ç—Ä–∏–∫–∞—Ö, –±–µ–∑ –∏–∑–ª–∏—à–Ω–∏—Ö –æ–ø–∏—Å–∞–Ω–∏–π
        - notes ‚Äî –∫—Ä–∞—Ç–∫–æ (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è), –±–µ–∑ HR-–ø–æ—ç—Ç–∏–∫–∏
        - –ò—Å–ø–æ–ª—å–∑—É–π –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π, –Ω–µ –≤—ã–¥—É–º—ã–≤–∞–π
        """
    )
    human = dedent(
        """\
        –°–≤–æ–¥–∫–∞ –æ–∫–Ω–∞:
        window: {window_json}
        messages:
        {messages_sample}

        JSON —à–∞–±–ª–æ–Ω:
        {{
          "tone": "neutral",
          "intensity": 0.45,
          "conflict": 0.22,
          "collaboration": 0.64,
          "stress": 0.31,
          "enthusiasm": 0.55,
          "notes": "–ö–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—à–∏ –¥—Ä–∞–π–≤–µ—Ä—ã —ç–º–æ—Ü–∏–π."
        }}
        """
    )
    return ChatPromptTemplate.from_messages([("system", system), ("human", human)])


def emotion_analyzer_repair_prompt_v1() -> ChatPromptTemplate:
    """–ü—Ä–æ–º–ø—Ç –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è JSON —ç–º–æ—Ü–∏–π."""
    system = "–ò—Å–ø—Ä–∞–≤—å JSON —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è, —Å–æ–±–ª—é–¥–∞–π –¥–∏–∞–ø–∞–∑–æ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏–π –∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è."
    human = (
        "–°–≤–æ–¥–∫–∞ –æ–∫–Ω–∞:\n{window_json}\n"
        "–§—Ä–∞–≥–º–µ–Ω—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π:\n{messages_sample}\n\n"
        "–ù–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç:\n{invalid_json}\n\n"
        "–û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:\n{errors}\n\n"
        "–í–µ—Ä–Ω–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON."
    )
    return ChatPromptTemplate.from_messages([("system", system), ("human", human)])


def role_classifier_prompt_v1() -> ChatPromptTemplate:
    """–ü—Ä–æ–º–ø—Ç –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–æ–ª–µ–π —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤."""
    system = dedent(
        """\
        –¢—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ—à—å —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–æ–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –æ–±—Å—É–∂–¥–µ–Ω–∏—è.
        –î–æ–ø—É—Å—Ç–∏–º—ã–µ —Ä–æ–ª–∏: initiator, expert, moderator, supporter, opponent, observer.
        –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
        - –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ —É–∫–∞–∑—ã–≤–∞–π –º–∞—Å—Å–∏–≤ roles —Å –≤–µ—Å–∞–º–∏ (0..1, —Å—É–º–º–∞ ‚â§ 1).
        - dominant_role = —Ä–æ–ª—å —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –≤–µ—Å–æ–º (–µ—Å–ª–∏ –Ω–µ—Ç, observer).
        - comment ‚Äî –ª–∞–∫–æ–Ω–∏—á–Ω–æ–µ (‚â§120 —Å–∏–º–≤–æ–ª–æ–≤) –ø–æ—è—Å–Ω–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∞ –∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å –æ—Ç—Å—ã–ª–∫–æ–π –∫ —Ç–∏–ø—É —Å–æ–æ–±—â–µ–Ω–∏–π.
        - –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–π –º–∏–Ω–∏–º—É–º 5 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–ª–∏ –≤—Å–µ—Ö, –µ—Å–ª–∏ –∏—Ö –º–µ–Ω—å—à–µ.
        - message_ids ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ —Å ID —Å–æ–æ–±—â–µ–Ω–∏–π, –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–∏—Å–≤–æ–µ–Ω–∞ —Ä–æ–ª—å.
        
        –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
        - –ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è –≤—ã–¥—É–º—ã–≤–∞—Ç—å —Ä–æ–ª–∏ –±–µ–∑ —Å—Å—ã–ª–æ–∫ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        - –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞, –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—à—å —Ä–æ–ª—å, –¥–∞–π 1-2 —Ñ—Ä–∞–∑—ã —Ä–µ–∑—é–º–µ —Å –æ—Ç—Å—ã–ª–∫–æ–π –∫ —Ç–∏–ø—É —Å–æ–æ–±—â–µ–Ω–∏–π (–∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–ª —Ç–µ–º—ã, –∑–∞–¥–∞–≤–∞–ª –≤–æ–ø—Ä–æ—Å—ã, –¥–∞–≤–∞–ª —Ä–µ—à–µ–Ω–∏—è –∏ —Ç.–ø.)
        - –ï—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ —É–≤–µ—Ä–µ–Ω–∞ –≤ —Ä–æ–ª–∏ ‚Äî –Ω–µ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–π –µ—ë (–Ω–µ –≤–∫–ª—é—á–∞–π —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
        - –†–æ–ª–∏ –¥–æ–ª–∂–Ω—ã –æ—Ç—Ä–∞–∂–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏: "–∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä —Ç–µ–º—ã", "–º–Ω–æ–≥–æ –æ—Ç–≤–µ—á–∞–ª", "–∑–∞–¥–∞–≤–∞–ª —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã", –∞ –Ω–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ "supporter/opponent"
        
        –û—Ç–≤–µ—Ç —Å—Ç—Ä–æ–≥–æ JSON –ø–æ —Å—Ö–µ–º–µ.
        """
    )
    human = dedent(
        """\
        –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—á–∞—Å—Ç–∏—è:
        {participant_stats}
        –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Å–µ–≥–º–µ–Ω—Ç—ã:
        {semantic_units}

        –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
        {{
          "participants": [
            {{
              "username": "alice",
              "roles": [{{"name": "initiator", "weight": 0.7}}, {{"name": "expert", "weight": 0.3}}],
              "dominant_role": "initiator",
              "message_ids": ["id1", "id5"],
              "comment": "–ó–∞–ø—É—Å—Ç–∏–ª–∞ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –∏ –¥–∞–ª–∞ —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏"
            }}
          ]
        }}
        """
    )
    return ChatPromptTemplate.from_messages([("system", system), ("human", human)])


def role_classifier_repair_prompt_v1() -> ChatPromptTemplate:
    """–ü—Ä–æ–º–ø—Ç –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è JSON –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ —Ä–æ–ª–µ–π."""
    system = (
        "–ò—Å–ø—Ä–∞–≤—å JSON —Å —Ä–æ–ª—è–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤. –°–ª–µ–¥–∏ –∑–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å—é –º–∞—Å—Å–∏–≤–∞ participants –∏ role_profile."
    )
    human = (
        "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—á–∞—Å—Ç–∏—è:\n{participant_stats}\n"
        "–°–µ–≥–º–µ–Ω—Ç—ã –æ–±—Å—É–∂–¥–µ–Ω–∏—è:\n{semantic_units}\n\n"
        "–ù–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç:\n{invalid_json}\n\n"
        "–û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:\n{errors}\n\n"
        "–í–µ—Ä–Ω–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON."
    )
    return ChatPromptTemplate.from_messages([("system", system), ("human", human)])


def topic_synthesizer_prompt_v1() -> ChatPromptTemplate:
    """–ü—Ä–æ–º–ø—Ç –¥–ª—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–º."""
    system = dedent(
        """\
        –¢—ã –∞–≥—Ä–µ–≥–∏—Ä—É–µ—à—å –∫–ª—é—á–µ–≤—ã–µ —Ç–µ–º—ã –æ–∫–Ω–∞ –æ–±—Å—É–∂–¥–µ–Ω–∏—è.
        –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
        - –ú–∞–∫—Å–∏–º—É–º 5 —Ç–µ–º, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É (critical > high > medium > low) –∏ msg_count.
        - –î–ª—è –∫–∞–∂–¥–æ–π —Ç–µ–º—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏:
          title ‚Äî –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–µ –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã —Ç–∏–ø–∞ "–û–±—â–µ–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ")
          priority, msg_count, threads ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã
          message_ids ‚Äî –º–∞—Å—Å–∏–≤ ID –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ —Ç–µ–º–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –µ—Å–ª–∏ –µ—Å—Ç—å)
          summary ‚Äî 2‚Äì3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å —Å—É—Ç—å—é –∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏.
          decision ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥, –¥–∞–∂–µ –µ—Å–ª–∏ ¬´–†–µ—à–µ–Ω–∏–µ –Ω–µ –ø—Ä–∏–Ω—è—Ç–æ¬ª.
          status ‚Äî –æ–¥–Ω–æ –∏–∑: done, in_progress, blocker, watch, idea.
          owners ‚Äî –º–∞—Å—Å–∏–≤ usernames –∫–ª—é—á–µ–≤—ã—Ö –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤.
          blockers ‚Äî –º–∞—Å—Å–∏–≤ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –∏–ª–∏ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫.
          actions ‚Äî —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫ ¬´@owner ‚Äî –¥–µ–π—Å—Ç–≤–∏–µ ‚Äî —Å—Ä–æ–∫/—Å—Ç–∞—Ç—É—Å¬ª. –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ —Ö–æ—Ç—å –æ–¥–Ω–æ "–¥–∞–≤–∞–π —Å–¥–µ–ª–∞–µ–º/–Ω–∞–¥–æ/–ø—Ä–µ–¥–ª–∞–≥–∞—é" ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∏ –≤ actions.
          signals ‚Äî —Å–ª–æ–≤–∞—Ä—å –º–µ—Ç—Ä–∏–∫ (tone, risk, impact, progress).
          keywords ‚Äî –¥–æ 5 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π.
          –ï—Å–ª–∏ –≤ —Ç–µ–º–µ –µ—Å—Ç—å –≤–ª–æ–∂–µ–Ω–∏—è, –≤–∫–ª—é—á–∏ –∏—Ö –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑ media_highlights_json –≤ summary –∏–ª–∏ actions.
        - Action items –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏.
        - –ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ç–µ–º—ã —Å title ‚àà {"–û–±—â–µ–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ", "–†–∞–∑–Ω–æ–µ", "–ë–µ–∑ —Ç–µ–º—ã"} –µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ–º.
        - –ï—Å–ª–∏ —Ç–µ–º—ã –≤—ã–¥–µ–ª–∏—Ç—å –Ω–µ–ª—å–∑—è, –≤–µ—Ä–Ω–∏ –æ–¥–Ω—É —Ç–µ–º—É ¬´–û–±—â–µ–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ¬ª —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º watch —Ç–æ–ª—å–∫–æ –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç.
        –û—Ç–≤–µ—Ç —Å—Ç—Ä–æ–≥–æ JSON.
        """
    )
    human = dedent(
        """\
        –°–µ–≥–º–µ–Ω—Ç—ã –æ–±—Å—É–∂–¥–µ–Ω–∏—è:
        {semantic_units}
        –≠–º–æ—Ü–∏–∏:
        {emotion_profile}
        –ú–µ–¥–∏–∞ –≤–ª–æ–∂–µ–Ω–∏—è:
        {media_highlights_json}

        –®–∞–±–ª–æ–Ω –æ—Ç–≤–µ—Ç–∞:
        {{
          "topics": [
            {{
              "title": "–ü—Ä–æ–±–ª–µ–º–∞ —Å –≤–µ–±–≤—å—é",
              "priority": "high",
              "msg_count": 15,
              "threads": ["thread-1-part1"],
              "summary": "–ö–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—à–∏ –∏—Å—Ö–æ–¥–Ω—É—é —Å–∏—Ç—É–∞—Ü–∏—é –∏ –∫–ª—é—á–µ–≤—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã.",
              "decision": "–û–±–Ω–æ–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç –¥–æ –≤–µ—Ä—Å–∏–∏ 2.3 –¥–æ –ø—è—Ç–Ω–∏—Ü—ã.",
              "status": "in_progress",
              "owners": ["boyversus"],
              "blockers": ["–ù—É–∂–Ω–∞ —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞"],
              "actions": ["@boyversus ‚Äî –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–∫—Å –Ω–∞ —Å—Ç–µ–Ω–¥–µ ‚Äî 15.11"],
              "signals": {{"tone": "neutral", "risk": "medium", "impact": "high", "progress": "0.6"}},
              "keywords": ["–≤–µ–±–≤—å—é", "–Ω–∞–≥—Ä—É–∑–∫–∞"]
            }}
          ]
        }}
        """
    )
    return ChatPromptTemplate.from_messages([("system", system), ("human", human)])


def topic_synthesizer_repair_prompt_v1() -> ChatPromptTemplate:
    """–ü—Ä–æ–º–ø—Ç –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è JSON —Ç–µ–º."""
    system = (
        "–ò—Å–ø—Ä–∞–≤—å JSON —Å —Ç–µ–º–∞–º–∏. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –∫–∞–∂–¥–∞—è —Ç–µ–º–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç summary, decision, status, actions, owners –∏ –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç 5 —Ç–µ–º. –ï—Å–ª–∏ media_highlights_json —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–ª–æ–∂–µ–Ω–∏—è, –æ—Ç—Ä–∞–∑–∏ –∫–ª—é—á–µ–≤—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è –≤ summary –∏–ª–∏ actions."
    )
    human = (
        "–°–µ–≥–º–µ–Ω—Ç—ã –æ–±—Å—É–∂–¥–µ–Ω–∏—è:\n{semantic_units}\n"
        "–≠–º–æ—Ü–∏–∏:\n{emotion_profile}\n\n"
        "–ù–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç:\n{invalid_json}\n\n"
        "–û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:\n{errors}\n\n"
        "–í–µ—Ä–Ω–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON."
    )
    return ChatPromptTemplate.from_messages([("system", system), ("human", human)])


def digest_composer_prompt_v1() -> ChatPromptTemplate:
    """–ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Telegram HTML –¥–∞–π–¥–∂–µ—Å—Ç–∞."""
    system = dedent(
        """\
        –¢—ã –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—à—å Telegram HTML –¥–∞–π–¥–∂–µ—Å—Ç –æ–±—Å—É–∂–¥–µ–Ω–∏—è.
        –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
        - –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —Ç–µ–≥–∏: <b>, <i>, <u>, <code>, <pre>, <a>, <ul>, <ol>, <li>, <br>.
        - –û–±—â–∞—è –¥–ª–∏–Ω–∞ (–ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞) ‚â§ 1200 —Å–∏–º–≤–æ–ª–æ–≤, –±–µ–∑ –≤–æ–¥—ã.
        - –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
          1. –ó–∞–≥–æ–ª–æ–≤–æ–∫: `üìä <b>–î–∞–π–¥–∂–µ—Å—Ç: {group_title}</b> | {period} | {message_count} —Å–æ–æ–±—â–µ–Ω–∏–π`.
          2. –ë–ª–æ–∫ `üéØ <b>–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã</b>` c <ul>, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ topics_json (–æ—Ç—Å–æ—Ä—Ç–∏—Ä—É–π –ø–æ priority –∏ msg_count). –ö–∞–∂–¥—ã–π <li> —Å–æ–¥–µ—Ä–∂–∏—Ç:
             ‚Ä¢ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç;
             ‚Ä¢ –∫—Ä–∞—Ç–∫–æ–µ summary (2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è);
             ‚Ä¢ <b>–†–µ—à–µ–Ω–∏–µ:</b> (–ø–æ–ª–µ decision);
             ‚Ä¢ —Å—Ç–∞—Ç—É—Å —Å —ç–º–æ–¥–∑–∏ (done ‚Üí ‚úÖ, in_progress ‚Üí üöß, blocker ‚Üí ‚ö†, watch ‚Üí üëÄ, idea ‚Üí üí°);
             ‚Ä¢ –∫–ª—é—á–µ–≤—ã—Ö –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤/owners;
             ‚Ä¢ —Å–ø–∏—Å–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π (actions) —á–µ—Ä–µ–∑ <br>.
          3. –ë–ª–æ–∫ `üë• <b>–ê–∫—Ç–∏–≤–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏</b>` —Å top-10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–∑ participants_json (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ message_count). –§–æ—Ä–º–∞—Ç `<li><b>@username</b> ‚Äî —Ä–æ–ª—å, —Å–æ–æ–±—â–µ–Ω–∏–π: N. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ...</li>`. –ï—Å–ª–∏ username –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–π placeholder `–±–µ–∑ –Ω–∏–∫–Ω–µ–π–º–∞`. –ï—Å–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –º–µ–Ω—å—à–µ 10, –ø–µ—Ä–µ—á–∏—Å–ª–∏ –≤—Å–µ—Ö, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫—É ¬´–ù–µ —É–∫–∞–∑–∞–Ω—ã¬ª.
          4. –ë–ª–æ–∫ `üñº <b>–ó–∞–º–µ—Ç–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è</b>` ‚Äî –¥–æ 5 –ø—É–Ω–∫—Ç–æ–≤ –∏–∑ media_highlights_json. –§–æ—Ä–º–∞—Ç `<li><b>–¢–∏–ø</b> ‚Äî –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (—É—á–∞—Å—Ç–Ω–∏–∫, –µ—Å–ª–∏ –µ—Å—Ç—å). {–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —è—Ä–ª—ã–∫}</li>`. –ï—Å–ª–∏ –≤–ª–æ–∂–µ–Ω–∏–π –Ω–µ—Ç, –≤—Å—ë —Ä–∞–≤–Ω–æ –¥–æ–±–∞–≤—å —Å—Ç—Ä–æ–∫—É ¬´–í–ª–æ–∂–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç¬ª.
          5. –ë–ª–æ–∫ `üìå <b>–ò—Ç–æ–≥–∏</b>` ‚Äî –≤—ã–∂–∏–º–∫–∞ —Ä–µ—à–µ–Ω–∏–π, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–Ω (tone, intensity, conflict/collaboration/stress/enthusiasm –∏–∑ metrics_json) –∏ —Å–≤–æ–¥–∫–∞ –ø–æ –º–µ–¥–∏–∞ (media_stats_json: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–ª–æ–∂–µ–Ω–∏–π, —Ç–∏–ø–æ–≤, –¥–æ–ª—è –±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏–π).
          6. –ë–ª–æ–∫ `üöÄ <b>–°–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è</b>` ‚Äî –∞–≥—Ä–µ–≥–∏—Ä—É–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (actions). –§–æ—Ä–º–∞—Ç `<li>@owner ‚Äî –¥–µ–π—Å—Ç–≤–∏–µ ‚Äî —Å—Ä–æ–∫/—Å—Ç–∞—Ç—É—Å</li>`. –ï—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ—Ç, –Ω–∞–ø–∏—à–∏ –æ–± —ç—Ç–æ–º —è–≤–Ω–æ.
        - –ù–µ —Ü–∏—Ç–∏—Ä—É–π —Å–æ–æ–±—â–µ–Ω–∏—è —Ü–µ–ª–∏–∫–æ–º, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π Markdown.
        - –ò—Å–ø–æ–ª—å–∑—É–π role_profile_json –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è —Ä–æ–ª–µ–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
        """
    )
    human = dedent(
        """\
        window:
        {window_json}
        topics:
        {topics_json}
        participants:
        {participants_json}
        role_profile:
        {role_profile_json}
        metrics:
        {metrics_json}
        media_highlights:
        {media_highlights_json}
        media_stats:
        {media_stats_json}
        baseline_digest:
        {baseline_digest}

        –°—Ñ–æ—Ä–º–∏—Ä—É–π –∏—Ç–æ–≥–æ–≤—ã–π HTML –¥–∞–π–¥–∂–µ—Å—Ç –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ.
        """
    )
    return ChatPromptTemplate.from_messages([("system", system), ("human", human)])


def digest_composer_retry_prompt_v1() -> ChatPromptTemplate:
    """–ü—Ä–æ–º–ø—Ç –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—â–µ–≥–æ —Å–∏–Ω—Ç–µ–∑–∞ –¥–∞–π–¥–∂–µ—Å—Ç–∞ (compact mode)."""
    system = dedent(
        """\
        –°—Ñ–æ—Ä–º–∏—Ä—É–π —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –¥–∞–π–¥–∂–µ—Å—Ç–∞, —Å–æ–±–ª—é–¥–∞—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –±–∞–∑–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞.
        –û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ:
        - –¢–æ—á–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏–π –∏ —Å—Ç–∞—Ç—É—Å–æ–≤.
        - –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–æ–≤ –∏ –ª–∏—à–Ω–∏—Ö —Å–ª–æ–≤.
        - –ß—ë—Ç–∫–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –¥–ª—è actions.
        –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ whitelist-—Ç–µ–≥–∏ –∏ —É–¥–µ—Ä–∂–∏–≤–∞–π –¥–ª–∏–Ω—É ‚â§ 1200 —Å–∏–º–≤–æ–ª–æ–≤.
        –í –±–ª–æ–∫–∞—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –≤–ª–æ–∂–µ–Ω–∏–π –∏ –∏—Ç–æ–≥–æ–≤ —Å–ª–µ–¥—É–π —Ç–µ–º –∂–µ –ø—Ä–∞–≤–∏–ª–∞–º, —á—Ç–æ –∏ –≤ –±–∞–∑–æ–≤–æ–º –ø—Ä–æ–º–ø—Ç–µ (top-10, —ç–º–æ-–º–∞—Ä–∫–µ—Ä—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–µ–¥–∏–∞).
        """
    )
    human = dedent(
        """\
        window:
        {window_json}
        topics:
        {topics_json}
        participants:
        {participants_json}
        role_profile:
        {role_profile_json}
        metrics:
        {metrics_json}
        media_highlights:
        {media_highlights_json}
        media_stats:
        {media_stats_json}
        baseline_digest:
        {baseline_digest}

        –°–¥–µ–ª–∞–π –¥–∞–π–¥–∂–µ—Å—Ç –±–æ–ª–µ–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º, –ø–æ–¥—á–µ—Ä–∫–Ω–∏ –∫–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ baseline.
        """
    )
    return ChatPromptTemplate.from_messages([("system", system), ("human", human)])


def digest_composer_prompt_v2() -> ChatPromptTemplate:
    """–ü—Ä–æ–º–ø—Ç v2 –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Telegram HTML –¥–∞–π–¥–∂–µ—Å—Ç–∞ —Å –∂—ë—Å—Ç–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∏ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–æ–π."""
    system = dedent(
        """\
        –¢—ã –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—à—å Telegram HTML –¥–∞–π–¥–∂–µ—Å—Ç –æ–±—Å—É–∂–¥–µ–Ω–∏—è —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫—É –∏ —Ä–µ—à–µ–Ω–∏—è.
        –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
        - –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —Ç–µ–≥–∏: <b>, <i>, <u>, <code>, <pre>, <a>, <ul>, <ol>, <li>, <br>.
        - –û–±—â–∞—è –¥–ª–∏–Ω–∞ (–ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞) ‚â§ 2000 —Å–∏–º–≤–æ–ª–æ–≤, –±–µ–∑ –≤–æ–¥—ã –∏ HR-–ø–æ—ç—Ç–∏–∫–∏.
        - –ñ–Å–°–¢–ö–ê–Ø –°–¢–†–£–ö–¢–£–†–ê (—Å–æ–±–ª—é–¥–∞–π –ø–æ—Ä—è–¥–æ–∫):
        
        1. –ó–∞–≥–æ–ª–æ–≤–æ–∫: `üìä <b>–î–∞–π–¥–∂–µ—Å—Ç: {group_title}</b> | {period} | {message_count} —Å–æ–æ–±—â–µ–Ω–∏–π`
        
        2. <b>üéØ –ß—Ç–æ –æ–±—Å—É–∂–¥–∞–ª–∏</b> (3-5 —Ç–µ–º):
           - –î–ª—è –∫–∞–∂–¥–æ–π —Ç–µ–º—ã –∏–∑ topics_json (–º–∏–Ω–∏–º—É–º 2, –º–∞–∫—Å–∏–º—É–º 5):
             ‚Ä¢ <b>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã</b> (–¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π)
             ‚Ä¢ 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å —Å—É—Ç—å—é –æ–±—Å—É–∂–¥–µ–Ω–∏—è
             ‚Ä¢ <b>–†–µ—à–µ–Ω–∏–µ:</b> –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –∏–∑ –ø–æ–ª—è decision (–µ—Å–ª–∏ –Ω–µ—Ç ‚Äî "–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–µ–π –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ")
             ‚Ä¢ –ï—Å–ª–∏ –µ—Å—Ç—å message_ids –≤ —Ç–µ–º–µ ‚Äî –¥–æ–±–∞–≤—å —Å—Å—ã–ª–∫—É: "–ö–ª—é—á–µ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è: [—Å—Å—ã–ª–∫–∏]"
             ‚Ä¢ –°—Ç–∞—Ç—É—Å —Å —ç–º–æ–¥–∑–∏: done ‚Üí ‚úÖ, in_progress ‚Üí üöß, blocker ‚Üí ‚ö†, watch ‚Üí üëÄ, idea ‚Üí üí°
           - –ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è –ø–∏—Å–∞—Ç—å "–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã: –ù–µ –≤—ã—è–≤–ª–µ–Ω—ã" –∏–ª–∏ "–∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥–∞–Ω–Ω—ã—Ö"
        
        3. <b>‚úÖ –†–µ—à–µ–Ω–∏—è –∏ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏</b>:
           - Bullets —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞–º–∏:
             ‚Ä¢ –ö—Ç–æ —á—Ç–æ –±–µ—Ä—ë—Ç (owners –∏–∑ topics)
             ‚Ä¢ –î–æ –∫–æ–≥–¥–∞ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ –≤ actions)
             ‚Ä¢ –ö–∞–∫–∏–µ —à–∞–≥–∏ (actions –∏–∑ topics)
           - –ï—Å–ª–∏ —Ä–µ—à–µ–Ω–∏–π –Ω–µ—Ç ‚Äî –Ω–∞–ø–∏—à–∏ —è–≤–Ω–æ: "–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–µ–π –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ"
        
        4. <b>‚ùì –û—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã</b>:
           - –°–ø–∏—Å–æ–∫ –Ω–µ –∑–∞–∫—Ä—ã—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ topics (status: watch, idea, blocker)
           - –ï—Å–ª–∏ –≤—Å–µ –∑–∞–∫—Ä—ã—Ç—ã ‚Äî –Ω–∞–ø–∏—à–∏: "–û—Ç–∫—Ä—ã—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–µ—Ç"
        
        5. <b>üë• –ê–∫—Ç–∏–≤–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏</b> (—Ç–æ–ª—å–∫–æ top-3 –ø–æ message_count):
           - –§–æ—Ä–º–∞—Ç: `<li><b>@username</b> ‚Äî [—Ä–æ–ª—å –ø–æ —Ñ—É–Ω–∫—Ü–∏–∏: –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä —Ç–µ–º—ã/–º–Ω–æ–≥–æ –æ—Ç–≤–µ—á–∞–ª/–∑–∞–¥–∞–≤–∞–ª –≤–æ–ø—Ä–æ—Å—ã], —Å–æ–æ–±—â–µ–Ω–∏–π: N. [–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∫–ª–∞–¥–∞]</li>`
           - –ï—Å–ª–∏ username –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π "–±–µ–∑ –Ω–∏–∫–Ω–µ–π–º–∞"
           - –†–æ–ª–∏ –ø–æ —Ñ—É–Ω–∫—Ü–∏—è–º, –∞ –Ω–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ (supporter/opponent)
           - –ï—Å–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –º–µ–Ω—å—à–µ 3 ‚Äî –ø–µ—Ä–µ—á–∏—Å–ª–∏ –≤—Å–µ—Ö
        
        6. <b>üìà –ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–æ—à–ª—ã–º –æ–∫–Ω–æ–º</b> (–µ—Å–ª–∏ –µ—Å—Ç—å baseline_delta –∏ has_baseline=true):
           - –ù–æ–≤—ã–µ —Ç–µ–º—ã: [novel_topics –∏–∑ baseline_delta]
           - –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Ç–µ–º: [topic_overlap –∏–∑ baseline_delta, –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö]
           - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ö–≤–∞—Ç–∞: [coverage_change –∏–∑ baseline_delta, –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö, ‚Üë/‚Üì]
           - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞: [quality_delta –∏–∑ baseline_delta, –µ—Å–ª–∏ –µ—Å—Ç—å]
           - –ï—Å–ª–∏ baseline_delta.has_baseline=false –∏–ª–∏ baseline_delta –ø—É—Å—Ç ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏ —ç—Ç–æ—Ç –±–ª–æ–∫
        
        7. <b>üñº –ó–∞–º–µ—Ç–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è</b> (–¥–æ 5 –∏–∑ media_highlights_json):
           - –§–æ—Ä–º–∞—Ç: `<li><b>–¢–∏–ø</b> ‚Äî –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (—É—á–∞—Å—Ç–Ω–∏–∫, –µ—Å–ª–∏ –µ—Å—Ç—å)</li>`
           - –ï—Å–ª–∏ –≤–ª–æ–∂–µ–Ω–∏–π –Ω–µ—Ç ‚Äî "–í–ª–æ–∂–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç"
        
        8. <b>üí≠ –≠–º–æ—Ü–∏–∏ –∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞</b> (1-2 —Å—Ç—Ä–æ–∫–∏, –∫–æ–º–ø–∞–∫—Ç–Ω–æ):
           - –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ –∏–∑ metrics_json: tone, intensity (–±–µ–∑ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏)
           - –ë–µ–∑ HR-–ø–æ—ç—Ç–∏–∫–∏ —Ç–∏–ø–∞ "—Å–ø–æ–∫–æ–π–Ω–∞—è –∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞"
        
        –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
        - –ú–∏–Ω–∏–º—É–º 2 —Ç–µ–º—ã, –º–∞–∫—Å–∏–º—É–º 5
        - –í—Å–µ —Ç–µ–º—ã –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫—É, –Ω–µ –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã
        - –°—Å—ã–ª–∫–∏ –Ω–∞ message_ids –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å –≤ topics
        - –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ "–ù–µ –≤—ã—è–≤–ª–µ–Ω—ã", "–∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥–∞–Ω–Ω—ã—Ö"
        - –§–æ–∫—É—Å –Ω–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–∏ –∏ —Ä–µ—à–µ–Ω–∏—è—Ö, –∞ –Ω–µ –Ω–∞ "–∞—Ç–º–æ—Å—Ñ–µ—Ä–µ"
        """
    )
    human = dedent(
        """\
        window:
        {window_json}
        topics:
        {topics_json}
        participants:
        {participants_json}
        role_profile:
        {role_profile_json}
        metrics:
        {metrics_json}
        media_highlights:
        {media_highlights_json}
        media_stats:
        {media_stats_json}
        baseline_delta:
        {baseline_delta}
        baseline_digest:
        {baseline_digest}

        –°—Ñ–æ—Ä–º–∏—Ä—É–π –∏—Ç–æ–≥–æ–≤—ã–π HTML –¥–∞–π–¥–∂–µ—Å—Ç –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π –∂—ë—Å—Ç–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫—É.
        """
    )
    return ChatPromptTemplate.from_messages([("system", system), ("human", human)])


def quality_evaluator_prompt_v1() -> ChatPromptTemplate:
    """–ü—Ä–æ–º–ø—Ç –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–π–¥–∂–µ—Å—Ç–∞."""
    system = dedent(
        """\
        –¢—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—à—å –∫–∞—á–µ—Å—Ç–≤–æ –¥–∞–π–¥–∂–µ—Å—Ç–∞ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º faithfulness, coherence, coverage, focus.
        –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [0,1].
        –î–æ–±–∞–≤—å –ø–æ–ª–µ quality_score (—Å—Ä–µ–¥–Ω–µ–µ –∏–∑ –º–µ—Ç—Ä–∏–∫) –∏ notes —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏. –û—Ç–≤–µ—Ç —Å—Ç—Ä–æ–≥–æ JSON.
        
        –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–í–ï–†–ö–ò:
        - –ï—Å–ª–∏ –≤ –¥–∞–π–¥–∂–µ—Å—Ç–µ –Ω–∞–ø–∏—Å–∞–Ω–æ "–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã: –ù–µ –≤—ã—è–≤–ª–µ–Ω—ã" –ø—Ä–∏ message_count >= 20, —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ (coverage=0.0, faithfulness=0.0)
        - –ü—Ä–æ–≤–µ—Ä—å –Ω–∞–ª–∏—á–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π, –æ—Ç–∫—Ä—ã—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤, —Å—Å—ã–ª–æ–∫ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        - –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Ç–µ–º—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫—É, –∞ –Ω–µ –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã
        - –ï—Å–ª–∏ –¥–∞–π–¥–∂–µ—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ "–∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥–∞–Ω–Ω—ã—Ö" –∏–ª–∏ "–Ω–µ –±—ã–ª–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö" ‚Äî —ç—Ç–æ –ø—Ä–∏–∑–Ω–∞–∫ –Ω–∏–∑–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ (coverage —Å–Ω–∏–∂–∞–µ—Ç—Å—è)
        - –£–±–µ–¥–∏—Å—å, —á—Ç–æ –¥–∞–π–¥–∂–µ—Å—Ç —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–∏ –∏ —Ä–µ—à–µ–Ω–∏—è—Ö, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞ "–∞—Ç–º–æ—Å—Ñ–µ—Ä–µ"
        """
    )
    human = dedent(
        """\
        –ò—Å—Ö–æ–¥–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
        {conversation_excerpt}
        –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç (HTML):
        {digest_html}

        –®–∞–±–ª–æ–Ω JSON:
        {{
          "faithfulness": 0.82,
          "coherence": 0.76,
          "coverage": 0.71,
          "focus": 0.74,
          "quality_score": 0.76,
          "notes": "–ö–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—à–∏ —Ä–∏—Å–∫–∏ –∏–ª–∏ —Ç–æ, —á—Ç–æ —É–ª—É—á—à–∏—Ç—å."
        }}
        """
    )
    return ChatPromptTemplate.from_messages([("system", system), ("human", human)])


def quality_evaluator_repair_prompt_v1() -> ChatPromptTemplate:
    """–ü—Ä–æ–º–ø—Ç –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è JSON –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞."""
    system = "–ò—Å–ø—Ä–∞–≤—å JSON –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞. –í—Å–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [0,1]."
    human = (
        "–ò—Å—Ö–æ–¥–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:\n{conversation_excerpt}\n"
        "–î–∞–π–¥–∂–µ—Å—Ç:\n{digest_html}\n\n"
        "–ù–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç:\n{invalid_json}\n\n"
        "–û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:\n{errors}\n\n"
        "–í–µ—Ä–Ω–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON."
    )
    return ChatPromptTemplate.from_messages([("system", system), ("human", human)])


__all__ = [
    "thread_builder_prompt_v1",
    "semantic_segmenter_prompt_v1",
    "semantic_segmenter_repair_prompt_v1",
    "emotion_analyzer_prompt_v1",
    "emotion_analyzer_repair_prompt_v1",
    "role_classifier_prompt_v1",
    "role_classifier_repair_prompt_v1",
    "topic_synthesizer_prompt_v1",
    "topic_synthesizer_repair_prompt_v1",
    "digest_composer_prompt_v1",
    "digest_composer_prompt_v2",
    "digest_composer_retry_prompt_v1",
    "quality_evaluator_prompt_v1",
    "quality_evaluator_repair_prompt_v1",
]

